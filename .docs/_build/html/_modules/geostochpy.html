<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>geostochpy &mdash; geostochpy Documentation 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=61a4c737" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
      <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
      <link rel="stylesheet" type="text/css" href="../_static/dark_mode_css/general.css?v=c0a7eb24" />
      <link rel="stylesheet" type="text/css" href="../_static/dark_mode_css/dark.css?v=70edf1c7" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=8d563738"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=ccdb6887"></script>
        <script src="../_static/design-tabs.js?v=36754332"></script>
        <script src="../_static/dark_mode_js/default_light.js?v=c2e647ce"></script>
        <script src="../_static/dark_mode_js/theme_switcher.js?v=358d3910"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            geostochpy Documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Slip_generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installing.html">Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../auto_examples/index.html">Stochastic process Gallery ðŸ˜„</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../team.html">Team Gallery</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">geostochpy Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">geostochpy</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for geostochpy</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module with functions necessary for the creation of faults and the calculation of slip distributions</span>
<span class="sd">    Author/Github: Alex Villarroel Carrasco / @alexvillarroel</span>
<span class="sd">    University of Concepcion,Chile.</span>

<span class="sd">    SOME FUNCTIONS ARE COPYRIGHTED BY RODRIGO CIFUENTES LOBOS</span>
<span class="sd">    in his github repository: @RCifuentesLobos : PaleoTsunami</span>
<span class="sd">    </span>
<span class="sd">    /</span>


<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> 
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">linalg</span> <span class="k">as</span> <span class="n">la</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span> 
<span class="kn">from</span> <span class="nn">mpl_toolkits.basemap</span> <span class="kn">import</span> <span class="n">Basemap</span><span class="p">,</span> <span class="n">cm</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccr</span>
<span class="kn">import</span> <span class="nn">cartopy.feature</span> <span class="k">as</span> <span class="nn">cf</span>
<span class="kn">import</span> <span class="nn">collections</span> <span class="k">as</span> <span class="nn">col</span>
<span class="kn">from</span> <span class="nn">geopy</span> <span class="kn">import</span> <span class="n">distance</span>
<span class="kn">import</span> <span class="nn">geographiclib</span> <span class="k">as</span> <span class="nn">geo</span> 
<span class="kn">from</span> <span class="nn">geographiclib.geodesic</span> <span class="kn">import</span> <span class="n">Geodesic</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">LinearNDInterpolator</span><span class="p">,</span> <span class="n">interp1d</span><span class="p">,</span><span class="n">RegularGridInterpolator</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">signal</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">lfilter</span><span class="p">,</span><span class="n">windows</span>
<span class="kn">import</span> <span class="nn">scipy.ndimage.filters</span> <span class="k">as</span> <span class="nn">filters</span>
<span class="kn">from</span> <span class="nn">clawpack.geoclaw</span> <span class="kn">import</span> <span class="n">dtopotools</span><span class="p">,</span> <span class="n">topotools</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span><span class="p">,</span> <span class="n">Process</span><span class="p">,</span> <span class="n">cpu_count</span>
<span class="kn">import</span> <span class="nn">rockhound</span> <span class="k">as</span> <span class="nn">rh</span>
<span class="kn">from</span> <span class="nn">rockhound.slab2</span> <span class="kn">import</span> <span class="n">ZONES</span>
<span class="kn">import</span> <span class="nn">pygmt</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<span class="c1"># Ms to Mw kausel Ramirez function</span>
<div class="viewcode-block" id="Mw_kauselramirez">
<a class="viewcode-back" href="../main.html#geostochpy.Mw_kauselramirez">[docs]</a>
<span class="k">def</span> <span class="nf">Mw_kauselramirez</span><span class="p">(</span><span class="n">ms</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    calculate the Mw with a ms</span>

<span class="sd">    :param ms: [description]</span>
<span class="sd">    :type ms: [type]</span>
<span class="sd">    :return: [description]</span>
<span class="sd">    :rtype: [type]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Ms to Mw kausel Ramirez function</span>
    <span class="n">logm0kauselramirez</span> <span class="o">=</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">ms</span><span class="o">+</span><span class="mf">16.30</span>
    <span class="n">Mw_calcs</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">/</span><span class="mf">3.0</span><span class="o">*</span><span class="n">logm0kauselramirez</span><span class="o">-</span><span class="mf">10.7</span> 
    <span class="n">Mw_calcs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Mw_calcs</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># 1 dec</span>
    <span class="k">return</span> <span class="n">Mw_calcs</span></div>

<span class="c1"># funcion para cargar datos de modelo slab2.0</span>
<div class="viewcode-block" id="load_files_slab2">
<a class="viewcode-back" href="../main.html#geostochpy.load_files_slab2">[docs]</a>
<span class="k">def</span> <span class="nf">load_files_slab2</span><span class="p">(</span><span class="n">zone</span><span class="o">=</span><span class="s1">&#39;south_america&#39;</span><span class="p">,</span><span class="n">rake</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Load data from the hayes 2018 slab2.0 model.</span>

<span class="sd">    Inputs:</span>
<span class="sd">    zone : str</span>
<span class="sd">    Subduction zone to fech the model.</span>
<span class="sd">    Available zones:</span>
<span class="sd">    - ``alaska``: Alaska</span>
<span class="sd">    - ``calabria``: Calabria</span>
<span class="sd">    - ``caribbean``: Caribbean</span>
<span class="sd">    - ``cascadia``: Cascadia</span>
<span class="sd">    - ``central_america``: Central America</span>
<span class="sd">    - ``cotabalo``: Cotabalo</span>
<span class="sd">    - ``halmahera``: Halmahera</span>
<span class="sd">    - ``hellenic``: Hellenic Arc</span>
<span class="sd">    - ``himalaya``: Himalaya</span>
<span class="sd">    - ``hindu_kush``: Hindu Kush</span>
<span class="sd">    - ``izu_bonin``: Izu-Bonin</span>
<span class="sd">    - ``kamchatka``: Kamchatka-Kuril Islands-Japan</span>
<span class="sd">    - ``kermadec``: Kermadec</span>
<span class="sd">    - ``makran``: Makran</span>
<span class="sd">    - ``manila_trench``: Manila Trench</span>
<span class="sd">    - ``muertos_trough``: Muertos Trough</span>
<span class="sd">    - ``new_guinea``: New Guinea</span>
<span class="sd">    - ``pamir``: Pamir</span>
<span class="sd">    - ``philippines``: Philippines</span>
<span class="sd">    - ``puysegur``: Puysegur</span>
<span class="sd">    - ``ryukyu``: Ryukyu</span>
<span class="sd">    - ``scotia_sea``: Scotia Sea</span>
<span class="sd">    - ``solomon_islands``: Solomon Islands</span>
<span class="sd">    - ``south_america``: South America</span>
<span class="sd">    - ``sulawesi``: Sulawesi</span>
<span class="sd">    - ``sumatra_java``: Sumatra-Java</span>
<span class="sd">    - ``vanuatu``: Vanuatu</span>
<span class="sd">    If you have and wanna load rake file,</span>
<span class="sd">    invoke function like load_file_slab2(zone,True)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># fetch slab2 model for zone with RockHound</span>
    <span class="n">slab_zone</span><span class="o">=</span><span class="n">rh</span><span class="o">.</span><span class="n">fetch_slab2</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>
    <span class="n">slabdep</span><span class="o">=</span><span class="n">pygmt</span><span class="o">.</span><span class="n">grd2xyz</span><span class="p">(</span><span class="n">slab_zone</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">slabdip</span><span class="o">=</span><span class="n">pygmt</span><span class="o">.</span><span class="n">grd2xyz</span><span class="p">(</span><span class="n">slab_zone</span><span class="o">.</span><span class="n">dip</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">slabstrike</span><span class="o">=</span><span class="n">pygmt</span><span class="o">.</span><span class="n">grd2xyz</span><span class="p">(</span><span class="n">slab_zone</span><span class="o">.</span><span class="n">strike</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="c1">#</span>
    <span class="n">directory</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;sam_rake.xyz&#39;</span><span class="p">)</span>
    <span class="n">slabdep</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">slabdip</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">slabstrike</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>   <span class="o">=</span> <span class="n">slabdep</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">360</span><span class="p">,</span> <span class="n">slabdip</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">360</span><span class="p">,</span><span class="n">slabstrike</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">360</span>
    <span class="c1"># Check if depth its in meters</span>
    <span class="n">slabdep</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">*=-</span><span class="mi">1</span>
    <span class="c1">## rake</span>
    <span class="k">if</span> <span class="n">rake</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">slabrake</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">delimiter</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">slabdep</span><span class="p">,</span><span class="n">slabdip</span><span class="p">,</span><span class="n">slabstrike</span><span class="p">,</span><span class="n">slabrake</span>

    <span class="k">return</span> <span class="n">slabdep</span><span class="p">,</span><span class="n">slabdip</span><span class="p">,</span><span class="n">slabstrike</span></div>

<span class="c1"># carga posicion de la fosa</span>

<div class="viewcode-block" id="load_trench">
<a class="viewcode-back" href="../main.html#geostochpy.load_trench">[docs]</a>
<span class="k">def</span> <span class="nf">load_trench</span><span class="p">(</span> <span class="n">trench_file</span> <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    upload file with the location of the south american plate trench</span>
<span class="sd">    Input: trench file</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">trench</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span> <span class="n">trench_file</span><span class="p">,</span> <span class="n">delimiter</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="p">)</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="n">trench</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="n">trench</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span></div>


<span class="c1"># carga datos del modelo PREM</span>

<div class="viewcode-block" id="load_PREM">
<a class="viewcode-back" href="../main.html#geostochpy.load_PREM">[docs]</a>
<span class="k">def</span> <span class="nf">load_PREM</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    carga los datos de velocidad de onda de corte del modelo prem</span>
<span class="sd">    directorio: directorio donde esta el archivo del modelo slab2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">PREM</span><span class="o">=</span><span class="n">rh</span><span class="o">.</span><span class="n">fetch_prem</span><span class="p">(</span><span class="n">load</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">prem_prof</span> <span class="o">=</span> <span class="n">PREM</span><span class="o">.</span><span class="n">depth</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span> <span class="c1"># en metros</span>
    <span class="n">prem_vs</span> <span class="o">=</span> <span class="n">PREM</span><span class="o">.</span><span class="n">Vsv</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span> <span class="c1"># velocidad Vsv en metros/segundos</span>

    <span class="k">return</span> <span class="n">prem_vs</span><span class="p">,</span> <span class="n">prem_prof</span></div>



<span class="c1"># Define la falla, ancho, largo y tamano de subfallas</span>

<div class="viewcode-block" id="crea_falla">
<a class="viewcode-back" href="../main.html#geostochpy.crea_falla">[docs]</a>
<span class="k">def</span> <span class="nf">crea_falla</span><span class="p">(</span> <span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">prof</span><span class="p">,</span> <span class="n">dip</span><span class="p">,</span> <span class="n">strike</span><span class="p">,</span> <span class="n">latini</span><span class="p">,</span> <span class="n">latfin</span><span class="p">,</span> <span class="n">area_sf</span><span class="p">,</span> <span class="n">profundidad</span><span class="p">,</span> <span class="n">razon_aspecto</span> <span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Crea una falla a partir de datos del modelo Slab2.0 de Hayes, 2018</span>
<span class="sd">    Entradas:</span>
<span class="sd">    lats: latitudes de Slab2.0</span>
<span class="sd">    lons: longitudes de Slab2.0</span>
<span class="sd">    prof: profundidades de Slab2.0</span>
<span class="sd">    dip: dip de Slab2.0</span>
<span class="sd">    strike: strike de Slab2.0</span>
<span class="sd">    latini: latitud inicial (norte)</span>
<span class="sd">    latfin: latitud final (sur)</span>
<span class="sd">    area_sf: Area deseada para cada subfalla</span>
<span class="sd">    profundidad: profundidad media de la falla, sobre la cual se calculara el punto medio de la distribucion</span>
<span class="sd">    razon_aspecto : Razon de aspecto de la falla (largo/ancho) se calcula el ancho de la falla a partir del largo, para respetar la relacion L/A = const. de Kanamori Anderson, 1975</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># se pasa los arrays de lats y lons a arrays unidimensionales que contienen las coordenadas sin repeticion</span>

    <span class="c1"># longitudes</span>
    <span class="n">vector_lon_input</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="c1"># primera fila de matriz de lons, columnas se repiten</span>
    <span class="c1"># se chequea si son crecientes monotonos, util para interpolacion </span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span> <span class="n">vector_lon_input</span><span class="p">,</span> <span class="n">vector_lon_input</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">)</span> <span class="p">):</span>
        <span class="n">vector_lon_input</span> <span class="o">=</span> <span class="n">vector_lon_input</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vector_lon_input</span> <span class="o">=</span> <span class="n">vector_lon_input</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># latitudes</span>
    <span class="n">vector_lat_input</span> <span class="o">=</span> <span class="n">lats</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># primera columna de matriz de lats, filas se repiten</span>
    <span class="c1"># se chequea si son crecientes monotonos, util para interpolacion </span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span> <span class="n">vector_lat_input</span><span class="p">,</span> <span class="n">vector_lat_input</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">)</span> <span class="p">):</span>
        <span class="n">vector_lat_input</span> <span class="o">=</span> <span class="n">vector_lat_input</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vector_lat_input</span> <span class="o">=</span> <span class="n">vector_lat_input</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>


    <span class="n">lim_norte</span> <span class="o">=</span> <span class="n">latini</span>  <span class="c1"># nuevo limite superior</span>
    <span class="n">dif_lim_norte</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">lats</span><span class="o">-</span><span class="n">lim_norte</span> <span class="p">)</span> <span class="c1"># diferencias entre array de latitudes y valor del limite superior</span>
    <span class="n">idx_lim_norte</span> <span class="o">=</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">dif_lim_norte</span> <span class="o">==</span> <span class="n">dif_lim_norte</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">dif_lim_norte</span> <span class="o">==</span> <span class="n">dif_lim_norte</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span><span class="c1"># indice del valor de Slab2.0 que mas se aproxima </span>

    <span class="n">lim_sur</span> <span class="o">=</span> <span class="n">latfin</span>  <span class="c1"># nuevo limite inferior</span>
    <span class="n">dif_lim_sur</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">lats</span><span class="o">-</span><span class="n">lim_sur</span> <span class="p">)</span> <span class="c1"># diferencias entre array de latitudes y valor del limite inferior</span>
    <span class="n">idx_lim_sur</span> <span class="o">=</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">dif_lim_sur</span> <span class="o">==</span> <span class="n">dif_lim_sur</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">dif_lim_sur</span> <span class="o">==</span> <span class="n">dif_lim_sur</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span><span class="c1"># indice del valor de Slab2.0 que mas se aproxima </span>

    <span class="c1"># se calcula la distancia entre los limites (largo de la falla) en metros</span>
    <span class="n">largo_falla</span> <span class="o">=</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">WGS84</span><span class="o">.</span><span class="n">Inverse</span><span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="n">idx_lim_norte</span><span class="p">],</span> <span class="n">lons</span><span class="p">[</span><span class="n">idx_lim_norte</span><span class="p">],</span> <span class="n">lats</span><span class="p">[</span><span class="n">idx_lim_sur</span><span class="p">],</span> <span class="n">lons</span><span class="p">[</span><span class="n">idx_lim_sur</span><span class="p">]</span> <span class="p">)[</span> <span class="s2">&quot;s12&quot;</span> <span class="p">]</span>
    <span class="n">largo_subfalla</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">area_sf</span> <span class="p">)</span> <span class="c1"># subfallas cuadradas</span>
    <span class="n">n_fallas_filas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor_divide</span><span class="p">(</span> <span class="n">largo_falla</span><span class="p">,</span> <span class="n">largo_subfalla</span> <span class="p">)</span> <span class="c1"># cantidad de fallas en sentido norte - sur  </span>
    <span class="c1"># a partir del numero de fallas en el sentido norte sur (ctdad de latitudes) se crea un vector de latitudes equidistantes</span>
    <span class="n">lats_fallas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span> <span class="n">lim_norte</span><span class="p">,</span> <span class="n">lim_sur</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span> <span class="n">n_fallas_filas</span> <span class="p">)</span> <span class="p">),(</span> <span class="nb">int</span><span class="p">(</span> <span class="n">n_fallas_filas</span> <span class="p">),</span><span class="mi">1</span> <span class="p">)</span> <span class="p">)</span>
    
    <span class="c1"># se busca la latitud del medio para referenciarla a la profundidad deseada</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lats_fallas</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">lat_mediana</span> <span class="o">=</span> <span class="n">lats_fallas</span><span class="p">[</span> <span class="n">np</span><span class="o">.</span><span class="n">floor_divide</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">lats_fallas</span> <span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lat_mediana</span> <span class="o">=</span> <span class="n">lats_fallas</span><span class="p">[</span> <span class="n">np</span><span class="o">.</span><span class="n">floor_divide</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">lats_fallas</span> <span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">]</span>

    <span class="c1"># busca indice de la latitud del medio</span>
    <span class="n">dif_lat_mediana</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">lats</span> <span class="o">-</span> <span class="n">lat_mediana</span> <span class="p">)</span>
    <span class="c1"># primer indice, muestra la linea de profundidades para esta latitud</span>
    <span class="n">idx_lat_mediana</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">dif_lat_mediana</span> <span class="o">==</span> <span class="n">dif_lat_mediana</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 
    <span class="c1"># se busca indice de la profundidad en la linea de la latitud media</span>
    <span class="n">dif_profundidad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">profundidad</span> <span class="o">-</span> <span class="n">prof</span><span class="p">[</span> <span class="n">idx_lat_mediana</span><span class="p">,</span> <span class="p">]</span> <span class="p">)</span>
    <span class="n">idx_profundidad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">dif_profundidad</span> <span class="o">==</span> <span class="n">dif_profundidad</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># indice elemento central de la falla creada, a partir de la latitud central y la profundidad</span>
    <span class="n">idx_subfalla_central</span> <span class="o">=</span> <span class="p">(</span> <span class="n">idx_lat_mediana</span><span class="p">,</span> <span class="n">idx_profundidad</span> <span class="p">)</span>

    <span class="c1"># longitud de la subfalla central</span>
    <span class="n">lon_subfalla_central</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span> <span class="n">idx_subfalla_central</span> <span class="p">]</span><span class="c1">#[0][0]</span>
    <span class="c1"># profundidad de la subfalla central (punto con la profundidad mas cercana a la ingresada)</span>
    <span class="n">prof_subfalla_central</span> <span class="o">=</span> <span class="n">prof</span><span class="p">[</span> <span class="n">idx_subfalla_central</span> <span class="p">]</span><span class="c1">#[0][0]</span>

    <span class="c1"># se busca los indices de los elementos mas cercanos a las latitudes de las fallas creadas por el linespace</span>
    <span class="n">dif_lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span> <span class="n">lats_fallas</span> <span class="p">),</span> <span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span> <span class="n">lats</span> <span class="p">)</span> <span class="p">)</span> <span class="c1"># inicializacion de array para diferencias de latitudes</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">lats_fallas</span> <span class="p">)</span> <span class="p">):</span>
        <span class="n">dif_lats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">lats</span> <span class="o">-</span> <span class="n">lats_fallas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span>
    
    <span class="n">idx_fallas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span> <span class="n">lats_fallas</span> <span class="p">),</span> <span class="p">)</span> <span class="o">+</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span> <span class="p">)</span> <span class="p">)</span> <span class="c1"># inicializacion de array con los indices de las latitudes </span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">lats_fallas</span> <span class="p">)</span> <span class="p">):</span>
        <span class="n">idx_fallas</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">dif_lats</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">dif_lats</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">dif_lats</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">dif_lats</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
    
    <span class="c1"># ancho de la falla</span>
    <span class="n">ancho_falla</span> <span class="o">=</span> <span class="n">largo_falla</span><span class="o">/</span><span class="n">razon_aspecto</span>
    <span class="n">n_fallas_columnas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor_divide</span><span class="p">(</span> <span class="n">ancho_falla</span><span class="p">,</span> <span class="n">largo_subfalla</span> <span class="p">)</span> <span class="c1"># numero de subfallas en el sentido este-oeste</span>
    <span class="c1"># completar array de latitudes con el nuevo ancho</span>
    <span class="c1">#matriz_latitudes = np.reshape(np.tile(lats_fallas, int(n_fallas_columnas)),(int(n_fallas_columnas),(len(lats_fallas))))</span>
    <span class="n">matriz_latitudes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span> <span class="n">lats_fallas</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span> <span class="n">n_fallas_columnas</span> <span class="p">)</span> <span class="p">)</span>
    <span class="c1"># creacion de array con  longitudes a usarse</span>
    <span class="c1"># calculo de longitudes de los centros de las subfallas a partir del ancho de la falla</span>
    <span class="c1"># es necesario saber si la cantidad es par o impar</span>
    <span class="k">if</span> <span class="n">n_fallas_columnas</span><span class="o">%</span><span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">mitad_ancho</span> <span class="o">=</span> <span class="n">ancho_falla</span> <span class="o">/</span> <span class="mi">2</span> <span class="c1"># en metros</span>
        <span class="n">n_fallas_xlado</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">n_fallas_columnas</span> <span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="c1"># cantidad de subfallas a ambos lados de falla central</span>
        <span class="n">lon_limite_oeste</span> <span class="o">=</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">WGS84</span><span class="o">.</span><span class="n">Direct</span><span class="p">(</span> <span class="n">lat_mediana</span><span class="p">,</span> <span class="n">lon_subfalla_central</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="n">mitad_ancho</span> <span class="p">)[</span> <span class="s2">&quot;lon2&quot;</span> <span class="p">]</span>
        <span class="n">lon_limite_este</span> <span class="o">=</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">WGS84</span><span class="o">.</span><span class="n">Direct</span><span class="p">(</span> <span class="n">lat_mediana</span><span class="p">,</span> <span class="n">lon_subfalla_central</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">mitad_ancho</span> <span class="p">)[</span> <span class="s2">&quot;lon2&quot;</span> <span class="p">]</span>
        <span class="n">lons_subfallas_oeste</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span> <span class="n">lon_limite_oeste</span><span class="p">,</span> <span class="n">lon_subfalla_central</span><span class="p">,</span> <span class="p">(</span> <span class="n">n_fallas_xlado</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">lons_subfallas_este</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span> <span class="n">lon_subfalla_central</span><span class="p">,</span> <span class="n">lon_limite_este</span><span class="p">,</span> <span class="p">(</span> <span class="n">n_fallas_xlado</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">lons_subfallas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">lons_subfallas_oeste</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">lons_subfallas_este</span> <span class="p">)</span> <span class="c1"># vector con las longitudes de las subfallas</span>
        <span class="n">lons_subfallas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span> <span class="n">lons_subfallas</span><span class="p">,</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span> <span class="n">n_fallas_columnas</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mitad_ancho</span> <span class="o">=</span> <span class="n">ancho_falla</span> <span class="o">/</span> <span class="mi">2</span> 
        <span class="n">n_fallas_oeste</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">n_fallas_columnas</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span> <span class="c1"># -1 para no contar 2 veces la subfalla del medio</span>
        <span class="n">n_fallas_este</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">n_fallas_columnas</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">lon_limite_oeste</span> <span class="o">=</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">WGS84</span><span class="o">.</span><span class="n">Direct</span><span class="p">(</span> <span class="n">lat_mediana</span><span class="p">,</span> <span class="n">lon_subfalla_central</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="p">(</span> <span class="n">mitad_ancho</span> <span class="o">-</span> <span class="n">largo_subfalla</span> <span class="p">)</span> <span class="p">)[</span> <span class="s2">&quot;lon2&quot;</span> <span class="p">]</span>
        <span class="n">lon_limite_este</span> <span class="o">=</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">WGS84</span><span class="o">.</span><span class="n">Direct</span><span class="p">(</span> <span class="n">lat_mediana</span><span class="p">,</span> <span class="n">lon_subfalla_central</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">mitad_ancho</span> <span class="p">)[</span> <span class="s2">&quot;lon2&quot;</span> <span class="p">]</span>
        <span class="n">lons_subfallas_oeste</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span> <span class="n">lon_limite_oeste</span><span class="p">,</span> <span class="n">lon_subfalla_central</span><span class="p">,</span> <span class="p">(</span> <span class="nb">int</span><span class="p">(</span> <span class="n">n_fallas_oeste</span> <span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">lons_subfallas_este</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span> <span class="n">lon_subfalla_central</span><span class="p">,</span> <span class="n">lon_limite_este</span><span class="p">,</span> <span class="p">(</span> <span class="nb">int</span><span class="p">(</span> <span class="n">n_fallas_este</span> <span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">lons_subfallas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">lons_subfallas_oeste</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">lons_subfallas_este</span> <span class="p">)</span> <span class="c1"># vector con las longitudes de las subfallas</span>
        <span class="n">lons_subfallas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span> <span class="n">lons_subfallas</span><span class="p">,</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span> <span class="n">n_fallas_columnas</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>

    <span class="c1"># creacion de matriz de longitudes</span>
    <span class="n">matriz_longitudes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span> <span class="n">lons_subfallas</span><span class="p">,</span> <span class="p">(</span> <span class="nb">int</span><span class="p">(</span> <span class="n">n_fallas_filas</span> <span class="p">),</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">)</span> <span class="c1"># matriz con longitudes de las subfallas</span>

    <span class="c1"># se debe encontrar las profundidades, dips y strikes correspondientes a estas latitudes y longitudes de cada subfalla</span>
    <span class="c1"># profundidades correspondientes a cada subfalla:</span>
    <span class="c1"># se interpolara para encontrar los valores de profundidad correspondientes a cada subfalla</span>
    
    <span class="n">vec_lons_subfallas_todas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span> <span class="n">matriz_longitudes</span><span class="p">,</span> 
        <span class="p">(</span> <span class="nb">int</span><span class="p">(</span> <span class="n">n_fallas_filas</span> <span class="o">*</span> <span class="n">n_fallas_columnas</span> <span class="p">),</span>  <span class="p">)</span> <span class="p">)</span> <span class="c1"># vector con todos los elementos de la matriz de longitudes de las subfallas creadas</span>
    <span class="n">vec_lats_subfallas_todas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span> <span class="n">matriz_latitudes</span><span class="p">,</span> 
        <span class="p">(</span> <span class="nb">int</span><span class="p">(</span> <span class="n">n_fallas_filas</span> <span class="o">*</span> <span class="n">n_fallas_columnas</span> <span class="p">),</span>  <span class="p">)</span> <span class="p">)</span> <span class="c1"># vector con todos los elementos de la matriz de latitudes de las subfallas creadas</span>


    <span class="c1"># objeto de interpolacion de profundidades</span>
    <span class="n">profs_int</span> <span class="o">=</span> <span class="n">RegularGridInterpolator</span><span class="p">(</span> <span class="p">(</span> <span class="n">vector_lat_input</span><span class="p">,</span> <span class="n">vector_lon_input</span> <span class="p">),</span> <span class="n">prof</span> <span class="p">)</span>
    <span class="c1"># inicializacion array de valores interpolados de profundidades</span>
    <span class="n">prof_subfallas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="p">(</span> <span class="nb">int</span><span class="p">(</span> <span class="n">n_fallas_columnas</span> <span class="o">*</span> <span class="n">n_fallas_filas</span> <span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">int</span><span class="p">(</span> <span class="n">n_fallas_columnas</span><span class="o">*</span><span class="n">n_fallas_filas</span> <span class="p">)</span> <span class="p">):</span>
        <span class="n">prof_subfallas</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">profs_int</span><span class="p">(</span> <span class="p">(</span> <span class="n">vec_lats_subfallas_todas</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">vec_lons_subfallas_todas</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
    <span class="n">prof_subfallas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span> <span class="n">prof_subfallas</span><span class="p">,</span> <span class="p">(</span> <span class="nb">int</span><span class="p">(</span> <span class="n">n_fallas_filas</span> <span class="p">),</span> <span class="nb">int</span><span class="p">(</span> <span class="n">n_fallas_columnas</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
    
    <span class="c1"># dips correspondientes a cada subfalla:</span>
    <span class="c1"># se interpolara para encontrar los valores de dip correspondientes a cada subfalla</span>

    <span class="c1"># objeto de interpolacion de dips</span>
    <span class="n">dips_int</span> <span class="o">=</span> <span class="n">RegularGridInterpolator</span><span class="p">(</span> <span class="p">(</span> <span class="n">vector_lat_input</span><span class="p">,</span> <span class="n">vector_lon_input</span> <span class="p">),</span> <span class="n">dip</span> <span class="p">)</span>
    <span class="c1"># inicializacion array de valores interpolados de dip</span>
    <span class="n">dip_subfallas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="p">(</span> <span class="nb">int</span><span class="p">(</span> <span class="n">n_fallas_columnas</span> <span class="o">*</span> <span class="n">n_fallas_filas</span> <span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">int</span><span class="p">(</span> <span class="n">n_fallas_columnas</span> <span class="o">*</span> <span class="n">n_fallas_filas</span> <span class="p">)</span> <span class="p">):</span>
        <span class="n">dip_subfallas</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">dips_int</span><span class="p">(</span> <span class="p">(</span> <span class="n">vec_lats_subfallas_todas</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">vec_lons_subfallas_todas</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
    <span class="n">dip_subfallas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span> <span class="n">dip_subfallas</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span> <span class="n">n_fallas_filas</span> <span class="p">),</span> <span class="nb">int</span><span class="p">(</span> <span class="n">n_fallas_columnas</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
    
    <span class="c1"># strike correspondiente a cada subfalla:</span>
    <span class="c1"># se interpolara para encontrar los valores de strike correspondientes a cada subfalla</span>

    <span class="c1"># objeto de interpolacion de strikes</span>
    <span class="n">strikes_int</span> <span class="o">=</span> <span class="n">RegularGridInterpolator</span><span class="p">(</span> <span class="p">(</span> <span class="n">vector_lat_input</span><span class="p">,</span> <span class="n">vector_lon_input</span> <span class="p">),</span> <span class="n">strike</span> <span class="p">)</span>
    <span class="c1"># inicializacion array de valores interpolados de strike</span>
    <span class="n">strike_subfallas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="p">(</span> <span class="nb">int</span><span class="p">(</span> <span class="n">n_fallas_columnas</span><span class="o">*</span><span class="n">n_fallas_filas</span> <span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">int</span><span class="p">(</span> <span class="n">n_fallas_columnas</span><span class="o">*</span><span class="n">n_fallas_filas</span> <span class="p">)</span> <span class="p">):</span>
        <span class="n">strike_subfallas</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">strikes_int</span><span class="p">(</span> <span class="p">(</span> <span class="n">vec_lats_subfallas_todas</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">vec_lons_subfallas_todas</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
    <span class="n">strike_subfallas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span> <span class="n">strike_subfallas</span><span class="p">,</span> <span class="p">(</span> <span class="nb">int</span><span class="p">(</span> <span class="n">n_fallas_filas</span> <span class="p">),</span> <span class="nb">int</span><span class="p">(</span> <span class="n">n_fallas_columnas</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
    <span class="c1"># revisar, quiza sea necesario invertir los valores de la latitud</span>




    <span class="k">return</span> <span class="n">largo_falla</span><span class="p">,</span> <span class="n">matriz_longitudes</span><span class="p">,</span> <span class="n">matriz_latitudes</span><span class="p">,</span> <span class="n">prof_subfallas</span><span class="p">,</span> <span class="n">dip_subfallas</span><span class="p">,</span> <span class="n">strike_subfallas</span></div>


<span class="c1"># crea la falla acomodandose a la fosa</span>
<div class="viewcode-block" id="make_fault_alongtrench">
<a class="viewcode-back" href="../main.html#geostochpy.make_fault_alongtrench">[docs]</a>
<span class="k">def</span> <span class="nf">make_fault_alongtrench</span><span class="p">(</span><span class="n">lons_trench</span><span class="p">,</span><span class="n">lats_trench</span><span class="p">,</span><span class="n">northlat</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">width</span><span class="p">,</span><span class="n">length</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function that creates a fault by calculating the latitudes and longitudes of various subfaults, considering the trench as a boundary.</span>
<span class="sd">    Inputs:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dx</span><span class="o">=</span><span class="n">width</span><span class="o">/</span><span class="n">nx</span>
    <span class="n">dy</span><span class="o">=</span><span class="n">length</span><span class="o">/</span><span class="n">ny</span>
    <span class="n">lats</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">lons</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">lats_ep</span><span class="o">=</span><span class="p">[]</span> <span class="c1"># _ep : center of each subfault </span>
    <span class="n">lons_ep</span><span class="o">=</span><span class="p">[]</span> <span class="c1">#</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ny</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nx</span><span class="p">):</span>
            <span class="n">lat</span><span class="o">=</span><span class="n">northlat</span><span class="o">-</span><span class="n">km2deg</span><span class="p">(</span><span class="n">dy</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">northlat</span><span class="o">-</span><span class="n">km2deg</span><span class="p">(</span><span class="n">dy</span><span class="o">*</span><span class="n">j</span><span class="p">))</span>
            <span class="n">lats_ep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
            <span class="n">lon</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="n">lats_trench</span><span class="p">,</span><span class="n">lons_trench</span><span class="p">)</span><span class="o">+</span><span class="n">km2deg</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="n">lats_trench</span><span class="p">,</span><span class="n">lons_trench</span><span class="p">)</span><span class="o">+</span><span class="n">km2deg</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">i</span><span class="p">))</span>
            <span class="n">lons_ep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lons</span><span class="p">,</span><span class="n">lons_ep</span><span class="p">,</span><span class="n">lats</span><span class="p">,</span><span class="n">lats_ep</span></div>

<span class="c1"># LATS SUBFALLAS</span>
<div class="viewcode-block" id="make_fault_alongtrench_optimized">
<a class="viewcode-back" href="../main.html#geostochpy.make_fault_alongtrench_optimized">[docs]</a>
<span class="k">def</span> <span class="nf">make_fault_alongtrench_optimized</span><span class="p">(</span><span class="n">lons_trench</span><span class="p">,</span> <span class="n">lats_trench</span><span class="p">,</span> <span class="n">northlat</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">width</span> <span class="o">/</span> <span class="n">nx</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">length</span> <span class="o">/</span> <span class="n">ny</span>
    <span class="c1">#</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ny</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="n">northlat</span> <span class="o">-</span> <span class="n">km2deg</span><span class="p">(</span><span class="n">dy</span> <span class="o">*</span> <span class="n">j</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span>
    <span class="n">lats_ep</span> <span class="o">=</span> <span class="n">northlat</span> <span class="o">-</span> <span class="n">km2deg</span><span class="p">(</span><span class="n">dy</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">j</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">lats_trench</span><span class="p">,</span> <span class="n">lons_trench</span><span class="p">)</span> <span class="o">+</span> <span class="n">km2deg</span><span class="p">(</span><span class="n">dx</span> <span class="o">*</span> <span class="n">i</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:])</span>
    <span class="n">lons_ep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">lats_ep</span><span class="p">,</span> <span class="n">lats_trench</span><span class="p">,</span> <span class="n">lons_trench</span><span class="p">)</span> <span class="o">+</span> <span class="n">km2deg</span><span class="p">(</span><span class="n">dx</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lons_ep</span><span class="p">,</span> <span class="n">lats</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">lats_ep</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span></div>

<div class="viewcode-block" id="interp_slabtofault">
<a class="viewcode-back" href="../main.html#geostochpy.interp_slabtofault">[docs]</a>
<span class="k">def</span> <span class="nf">interp_slabtofault</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span><span class="n">lats</span><span class="p">,</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">slabdep</span><span class="p">,</span><span class="n">slabdip</span><span class="p">,</span><span class="n">slabstrike</span><span class="p">,</span><span class="n">slabrake</span><span class="p">):</span>
    <span class="c1"># # limits stochastic grid</span>
    <span class="n">lonwest</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span>
    <span class="n">lonest</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span>
    <span class="n">latnorth</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span>
    <span class="n">latsouth</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span>

    <span class="n">ind_sup_lons</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">slabdep</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="n">lonwest</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># +-1 for best interpolation</span>
    <span class="n">ind_inf_lons</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">slabdep</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="n">lonest</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">index_lons</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">ind_sup_lons</span><span class="p">,</span><span class="n">ind_inf_lons</span><span class="p">))</span>
    <span class="c1"># delete </span>
    <span class="n">slabdep</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">slabdep</span><span class="p">,</span><span class="n">index_lons</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">slabdip</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">slabdip</span><span class="p">,</span><span class="n">index_lons</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">slabstrike</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">slabstrike</span><span class="p">,</span><span class="n">index_lons</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">ind_sup_lats</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">slabdep</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="p">(</span><span class="n">latsouth</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="c1"># +-1 for best interpolation</span>
    <span class="n">ind_inf_lats</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">slabdep</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="p">(</span><span class="n">latnorth</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">index_lats</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">ind_sup_lats</span><span class="p">,</span><span class="n">ind_inf_lats</span><span class="p">))</span>
    <span class="c1"># delete</span>
    <span class="n">slabdep</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">slabdep</span><span class="p">,</span><span class="n">index_lats</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">slabdip</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">slabdip</span><span class="p">,</span><span class="n">index_lats</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">slabstrike</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">slabstrike</span><span class="p">,</span><span class="n">index_lats</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">slabdep</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">slabdep</span><span class="o">=</span><span class="n">slabdep</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span>
    <span class="n">slabdip</span><span class="o">=</span><span class="n">slabdip</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span>
    <span class="n">slabstrike</span><span class="o">=</span><span class="n">slabstrike</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span>
    <span class="c1">#</span>
    <span class="n">X_grid</span><span class="p">,</span><span class="n">Y_grid</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">lons</span><span class="p">,(</span><span class="n">ny</span><span class="p">,</span><span class="n">nx</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">lats</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,(</span><span class="n">ny</span><span class="p">,</span><span class="n">nx</span><span class="p">))</span>
    <span class="n">interp_dep</span><span class="o">=</span><span class="n">LinearNDInterpolator</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">slabdep</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">slabdep</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])),</span><span class="n">slabdep</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">interp_dip</span><span class="o">=</span><span class="n">LinearNDInterpolator</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">slabdip</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">slabdip</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])),</span><span class="n">slabdip</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">interp_strike</span><span class="o">=</span><span class="n">LinearNDInterpolator</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">slabdip</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">slabstrike</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])),</span><span class="n">slabstrike</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">interp_rake</span><span class="o">=</span><span class="n">LinearNDInterpolator</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">slabrake</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">slabrake</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])),</span><span class="n">slabrake</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">dep</span><span class="o">=</span><span class="n">interp_dep</span><span class="p">(</span><span class="n">X_grid</span><span class="p">,</span><span class="n">Y_grid</span><span class="p">)</span>
    <span class="n">dip</span><span class="o">=</span><span class="n">interp_dip</span><span class="p">(</span><span class="n">X_grid</span><span class="p">,</span><span class="n">Y_grid</span><span class="p">)</span>
    <span class="n">strike</span><span class="o">=</span><span class="n">interp_strike</span><span class="p">(</span><span class="n">X_grid</span><span class="p">,</span><span class="n">Y_grid</span><span class="p">)</span>
    <span class="n">rake</span><span class="o">=</span><span class="n">interp_rake</span><span class="p">(</span><span class="n">X_grid</span><span class="p">,</span><span class="n">Y_grid</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X_grid</span><span class="p">,</span><span class="n">Y_grid</span><span class="p">,</span><span class="n">dep</span><span class="p">,</span><span class="n">dip</span><span class="p">,</span><span class="n">strike</span><span class="p">,</span><span class="n">rake</span></div>


<span class="c1"># Estima el tiempo de ruptura (tau) de la falla</span>

<div class="viewcode-block" id="tau_ruptura_BilekModel">
<a class="viewcode-back" href="../main.html#geostochpy.tau_ruptura_BilekModel">[docs]</a>
<span class="k">def</span> <span class="nf">tau_ruptura_BilekModel</span><span class="p">(</span> <span class="n">largo_subfalla</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="mi">3500</span><span class="p">,</span><span class="n">prem</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">profs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Para modelo sin PREM, es decir, velocidad de corte constante</span>
<span class="sd">    #</span>
<span class="sd">    Calcula el tiempo de ruptura de la falla dada a partir del largo de falla, considerando</span>
<span class="sd">    la velocidad de ruptura como 0.8 de la velocidad de propagacion de onda S y </span>
<span class="sd">    una velocidad de cizalle de 3.5 km/s utilizando la aproximacion dada en Bilek y Lay, 1999</span>
<span class="sd">    tau approx L/(0.8beta) </span>
<span class="sd">    Entradas: </span>
<span class="sd">    largo_falla: largo de la falla en metros dado por la funcion que crea la falla</span>
<span class="sd">    beta: velocidad de la onda de cizalle en metros/segundo</span>
<span class="sd">    #</span>
<span class="sd">    Para modelo prem, es decir, velocidad de corte variable </span>
<span class="sd">    Calcula el tiempo de ruptura de la falla dada a partir del largo de falla, considerando</span>
<span class="sd">    la velocidad de ruptura como 0.8 de la velocidad de propagacion de onda S y </span>
<span class="sd">    una velocidad de cizalle dependiente de la profundidad media de la falla</span>
<span class="sd">    y la velocidad vs asociada a esta en el modelo prem, utilizando la aproximacion dada en Bilek y Lay, 1999</span>
<span class="sd">    tau approx L/(0.8beta) </span>
<span class="sd">    Entradas: </span>
<span class="sd">    largo_falla: largo de la falla en metros dado por la funcion que crea la falla</span>
<span class="sd">    prof_media: profundidad media de la falla</span>
<span class="sd">    prof_prem: profundidades del modelo prem</span>
<span class="sd">    vs: modelo de velocidades del modelo prem asociadas a las profundidades de prof_prem</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># se chequean unidades de medida de beta, tiene que estar en metros/s, no km/s</span>
    <span class="k">if</span> <span class="n">prem</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">beta</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span> <span class="o">*</span> <span class="mi">1000</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span>

        <span class="n">tau</span> <span class="o">=</span> <span class="n">largo_subfalla</span><span class="o">/</span><span class="p">(</span> <span class="mf">0.8</span> <span class="o">*</span> <span class="n">beta</span> <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">PREM</span><span class="o">=</span><span class="n">rh</span><span class="o">.</span><span class="n">fetch_prem</span><span class="p">(</span><span class="n">load</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">prem_prof</span> <span class="o">=</span> <span class="n">PREM</span><span class="o">.</span><span class="n">depth</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span> <span class="c1"># en metros</span>
        <span class="n">prem_vsv</span> <span class="o">=</span> <span class="n">PREM</span><span class="o">.</span><span class="n">Vsv</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span> <span class="c1"># velocidad Vsv en metros/segundos</span>
        <span class="n">vs_prof_media</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">profs</span><span class="p">,</span><span class="n">prem_prof</span><span class="p">,</span><span class="n">prem_vsv</span><span class="p">)</span>

        <span class="c1"># puede que la profundidad media de la falla se encuentre justo entre 2 valores del modelo</span>
        <span class="c1"># si esto sucede, se calcula el promedio de las velocidades de ambos</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="n">largo_subfalla</span><span class="o">/</span><span class="p">(</span> <span class="mf">0.8</span> <span class="o">*</span> <span class="n">vs_prof_media</span> <span class="p">)</span>


    <span class="k">return</span> <span class="n">tau</span></div>


<span class="c1"># Version alternativa de estimacion de tiempo de ruptura (tau) de la falla, utilizando la profundidad de la falla y </span>
<span class="c1"># la de velocidad de onda de cizalle del modelo PREM</span>
<span class="c1"># suele sobreestimar los valores de rigidez usualmente presentes en la zona de subduccion </span>
<span class="c1"># Estima rigidez a partir de la ecuacion presentada en Bilek y Lay, 1999</span>

<div class="viewcode-block" id="estima_rigidez_BilekModel">
<a class="viewcode-back" href="../main.html#geostochpy.estima_rigidez_BilekModel">[docs]</a>
<span class="k">def</span> <span class="nf">estima_rigidez_BilekModel</span><span class="p">(</span> <span class="n">largo_subfalla</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span><span class="n">prem</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">profs</span><span class="o">=</span><span class="kc">None</span> <span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estima la rigidez de la falla dado el tiempo de ruptura y el largo de la falla</span>
<span class="sd">    segun la relacion dada en Bilek y Lay, 1999 mu = densidad*largo_falla**2/(0.8**2*tau**2).</span>
<span class="sd">    entradas: </span>
<span class="sd">    largo_falla: largo de la falla en metros</span>
<span class="sd">    tau: tiempo de duracion de la ruptura</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">PREM</span><span class="o">=</span><span class="n">rh</span><span class="o">.</span><span class="n">fetch_prem</span><span class="p">(</span><span class="n">load</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">prem_prof</span> <span class="o">=</span> <span class="n">PREM</span><span class="o">.</span><span class="n">depth</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span> <span class="c1"># en metros</span>
    <span class="n">prem_rho</span> <span class="o">=</span> <span class="n">PREM</span><span class="o">.</span><span class="n">density</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span> <span class="c1"># densidad en kg/m3</span>
    <span class="n">interp_rho</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span> <span class="n">prem_prof</span><span class="p">,</span> <span class="n">prem_rho</span><span class="p">)</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">interp_rho</span><span class="p">(</span><span class="n">profs</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">profs</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
    <span class="c1">#</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="p">(</span> <span class="n">rho</span> <span class="o">*</span> <span class="p">(</span> <span class="n">largo_subfalla</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> <span class="p">)</span><span class="o">/</span><span class="p">(</span> <span class="p">(</span> <span class="mf">0.8</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="n">tau</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">mu</span></div>


<span class="c1"># estima rigidez a partir del modelo PREM</span>

<div class="viewcode-block" id="estima_rigidez_prem">
<a class="viewcode-back" href="../main.html#geostochpy.estima_rigidez_prem">[docs]</a>
<span class="k">def</span> <span class="nf">estima_rigidez_prem</span><span class="p">(</span><span class="n">profs</span> <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estima la rigidez de cada subfalla en funcion de su profunidad a partir de los </span>
<span class="sd">    datos de velocidad de onda S y densdidad del modelo PREM, dada Vs=sqrt(mu/rho)</span>
<span class="sd">    Entradas:</span>
<span class="sd">    profs: profundidades de las subfallas</span>
<span class="sd">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    carga los datos de velocidad de onda de corte del modelo prem</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">PREM</span><span class="o">=</span><span class="n">rh</span><span class="o">.</span><span class="n">fetch_prem</span><span class="p">(</span><span class="n">load</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">prem_prof</span> <span class="o">=</span> <span class="n">PREM</span><span class="o">.</span><span class="n">depth</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span> <span class="c1"># en metros</span>
    <span class="n">prem_vsv</span> <span class="o">=</span> <span class="n">PREM</span><span class="o">.</span><span class="n">Vsv</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span> <span class="c1"># velocidad Vsv en metros/segundos</span>
    <span class="n">prem_vsh</span> <span class="o">=</span> <span class="n">PREM</span><span class="o">.</span><span class="n">Vsh</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span> <span class="c1"># velocidad Vsh en metros/segundos</span>
    <span class="n">prem_vs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">prem_vsv</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">prem_vsh</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># promedio de las velocidades de onda de corte</span>
    <span class="n">prem_rho</span> <span class="o">=</span> <span class="n">PREM</span><span class="o">.</span><span class="n">density</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span> <span class="c1"># densidad en m3/kg</span>
    <span class="n">rigidez</span> <span class="o">=</span> <span class="p">(</span> <span class="n">prem_vsv</span> <span class="o">*</span> <span class="n">prem_vsv</span> <span class="p">)</span> <span class="o">*</span> <span class="n">prem_rho</span> <span class="c1"># rigidez en Pa</span>

    <span class="c1"># se crea el interpolador </span>
    <span class="n">interp_rigidez</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span> <span class="n">prem_prof</span><span class="p">,</span> <span class="n">rigidez</span><span class="p">)</span>

    <span class="c1"># se inicializa el array que contendra la rigidez de cada subfalla</span>

    <span class="n">rigidez_sf</span><span class="o">=</span><span class="n">interp_rigidez</span><span class="p">(</span><span class="n">profs</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">profs</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">rigidez_sf</span></div>



<span class="c1"># calcula las distancias entre subfallas</span>
<span class="c1"># sin uso, utilizar version alternativa</span>
<div class="viewcode-block" id="dist_haversine">
<a class="viewcode-back" href="../main.html#geostochpy.dist_haversine">[docs]</a>
<span class="k">def</span> <span class="nf">dist_haversine</span><span class="p">(</span><span class="n">lon1</span><span class="p">,</span> <span class="n">lon2</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lat2</span><span class="p">):</span>
    <span class="c1"># Convertir grados a radianes</span>
    <span class="n">lon1</span><span class="p">,</span> <span class="n">lon2</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lat2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lon1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lon2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat2</span><span class="p">)</span>

    <span class="c1"># Diferencias en longitudes y latitudes</span>
    <span class="n">dlon</span> <span class="o">=</span> <span class="n">lon2</span> <span class="o">-</span> <span class="n">lon1</span>
    <span class="n">dlat</span> <span class="o">=</span> <span class="n">lat2</span> <span class="o">-</span> <span class="n">lat1</span>

    <span class="c1"># FÃ³rmula de Haversine</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dlat</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dlon</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>

    <span class="c1"># Radio de la Tierra en metros (aproximaciÃ³n para latitudes medias)</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="mi">6371000</span>

    <span class="c1"># Distancia en metros</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">c</span>

    <span class="k">return</span> <span class="n">distance</span></div>

<div class="viewcode-block" id="dist_sf_vectorized">
<a class="viewcode-back" href="../main.html#geostochpy.dist_sf_vectorized">[docs]</a>
<span class="k">def</span> <span class="nf">dist_sf_vectorized</span><span class="p">(</span><span class="n">lon1</span><span class="p">,</span> <span class="n">lon2</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lat2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the distance between two points on the sphere .</span>

<span class="sd">    :param lon1: [description]</span>
<span class="sd">    :type lon1: [type]</span>
<span class="sd">    :param lon2: [description]</span>
<span class="sd">    :type lon2: [type]</span>
<span class="sd">    :param lat1: [description]</span>
<span class="sd">    :type lat1: [type]</span>
<span class="sd">    :param lat2: [description]</span>
<span class="sd">    :type lat2: [type]</span>
<span class="sd">    :return: [description]</span>
<span class="sd">    :rtype: [type]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Vectorizar la funciÃ³n de distancia geodÃ©sica</span>
    <span class="n">vectorized_dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="k">lambda</span> <span class="n">lon1</span><span class="p">,</span> <span class="n">lon2</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lat2</span><span class="p">:</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">WGS84</span><span class="o">.</span><span class="n">Inverse</span><span class="p">(</span><span class="n">lat1</span><span class="p">,</span> <span class="n">lon1</span><span class="p">,</span> <span class="n">lat2</span><span class="p">,</span> <span class="n">lon2</span><span class="p">)[</span> <span class="s2">&quot;s12&quot;</span> <span class="p">])</span>

    <span class="c1"># Calcular las distancias para cada par de coordenadas</span>
    <span class="n">distances</span> <span class="o">=</span> <span class="n">vectorized_dist</span><span class="p">(</span><span class="n">lon1</span><span class="p">,</span> <span class="n">lon2</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lat2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">distances</span></div>

<div class="viewcode-block" id="dist_sf">
<a class="viewcode-back" href="../main.html#geostochpy.dist_sf">[docs]</a>
<span class="k">def</span> <span class="nf">dist_sf</span><span class="p">(</span> <span class="n">lon1</span><span class="p">,</span> <span class="n">lon2</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lat2</span> <span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calcula la distancia en metros entre dos subfallas (sf) i y j utilizando el metodo de karney, 2013 y el elipsoide wgs84</span>
<span class="sd">    Entradas:</span>
<span class="sd">    lon1: longitud de subfalla i-esima</span>
<span class="sd">    lon2: longitud de subfalla j-esima</span>
<span class="sd">    lat1: latitud de subfalla i-esima</span>
<span class="sd">    lat2: latitud de subfalla j-esima</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#dx=deg2km(np.abs(lon1-lon2))*1000</span>
    <span class="c1">#dy=deg2km(np.abs(lat1-lat2))*1000</span>
    <span class="c1">#distancia=np.sqrt(dx**2+dy**2)</span>
    <span class="n">subfalla_i</span> <span class="o">=</span> <span class="p">(</span><span class="n">lon1</span><span class="p">,</span> <span class="n">lat1</span><span class="p">)</span>
    <span class="n">subfalla_j</span> <span class="o">=</span> <span class="p">(</span><span class="n">lon2</span><span class="p">,</span> <span class="n">lat2</span><span class="p">)</span>
    <span class="n">distancia</span> <span class="o">=</span> <span class="n">distance</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span> <span class="n">subfalla_i</span><span class="p">,</span> <span class="n">subfalla_j</span> <span class="p">)</span><span class="o">.</span><span class="n">meters</span>
    <span class="k">return</span> <span class="n">distancia</span></div>

<span class="c1"># metodo alternativo de calculo de distancias entre subfallas</span>
<div class="viewcode-block" id="dist_sf_alt">
<a class="viewcode-back" href="../main.html#geostochpy.dist_sf_alt">[docs]</a>
<span class="k">def</span> <span class="nf">dist_sf_alt</span><span class="p">(</span> <span class="n">lon1</span><span class="p">,</span> <span class="n">lon2</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lat2</span> <span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calcula la distancia en metros entre dos subfallas (sf) i y j resolviendo el problema inverso </span>
<span class="sd">    de la geodesia. Utiliza el elipsoide WGS84. </span>
<span class="sd">    Entradas:</span>
<span class="sd">    lon1: longitud de subfalla i-esima</span>
<span class="sd">    lon2: longitud de subfalla j-esima</span>
<span class="sd">    lat1: latitud de subfalla i-esima</span>
<span class="sd">    lat2: latitud de subfalla j-esima</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dist</span> <span class="o">=</span> <span class="n">Geodesic</span><span class="o">.</span><span class="n">WGS84</span><span class="o">.</span><span class="n">Inverse</span><span class="p">(</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lon1</span><span class="p">,</span> <span class="n">lat2</span><span class="p">,</span> <span class="n">lon2</span> <span class="p">)[</span> <span class="s2">&quot;s12&quot;</span> <span class="p">]</span>
    
    <span class="k">return</span> <span class="n">dist</span></div>


<span class="c1"># taper para medias</span>

<div class="viewcode-block" id="taper_LeVeque">
<a class="viewcode-back" href="../main.html#geostochpy.taper_LeVeque">[docs]</a>
<span class="k">def</span> <span class="nf">taper_LeVeque</span><span class="p">(</span> <span class="n">d</span><span class="p">,</span><span class="n">dmax</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    realiza el taper propuesto por leveque et al., 2016</span>
<span class="sd">    t(d)=1-exp(-20|d-dmax|/dmax) </span>
<span class="sd">    donde dmax es la profunidad maxima y de la falla y d es la profundidad</span>
<span class="sd">    de cada subfalla</span>
<span class="sd">    Entrada:</span>
<span class="sd">    d: matriz con profundidades</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">d</span><span class="p">[</span><span class="n">d</span><span class="o">&gt;=</span><span class="n">dmax</span><span class="p">]</span><span class="o">=</span><span class="n">dmax</span>
    <span class="n">taper</span> <span class="o">=</span> <span class="p">(</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="o">-</span><span class="mi">20</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span> <span class="n">d</span> <span class="o">-</span> <span class="n">dmax</span> <span class="p">)</span><span class="o">/</span><span class="n">dmax</span> <span class="p">)</span> <span class="p">)</span>
    <span class="n">taper</span><span class="p">[</span><span class="n">taper</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">taper</span><span class="p">[</span><span class="n">taper</span><span class="o">!=</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">taper</span></div>

<span class="c1"># calculo de medias</span>
<div class="viewcode-block" id="matriz_medias">
<a class="viewcode-back" href="../main.html#geostochpy.matriz_medias">[docs]</a>
<span class="k">def</span> <span class="nf">matriz_medias</span><span class="p">(</span> <span class="n">media</span><span class="p">,</span> <span class="n">prof</span> <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    calcula las medias mu_i para cada subfalla segun mu_i = log(mu*tau_i)-1/2log(alpha**2+1)</span>
<span class="sd">    Entradas:</span>
<span class="sd">    media: valor promedio alrededor del que se desea que se centre el slip</span>
<span class="sd">    prof: matriz con profundidades de cada subfalla, necesaria para el taper</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="n">taper_LeVeque</span><span class="p">(</span> <span class="n">prof</span><span class="p">,</span><span class="mi">50000</span><span class="p">)</span> <span class="c1"># taper</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="c1"># valor sugerido por LeVeque et al, 2016</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span> <span class="n">media</span><span class="o">*</span><span class="n">tau</span> <span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span> <span class="n">alpha</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">mu</span></div>

<div class="viewcode-block" id="matriz_medias_villarroel">
<a class="viewcode-back" href="../main.html#geostochpy.matriz_medias_villarroel">[docs]</a>
<span class="k">def</span> <span class="nf">matriz_medias_villarroel</span><span class="p">(</span><span class="n">media</span><span class="p">,</span><span class="n">taper</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="c1">#alpha = 0.75 valor sugerido por LeVeque et al, 2016</span>
    <span class="n">taper</span><span class="p">[</span><span class="n">taper</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">taper</span><span class="p">[</span><span class="n">taper</span><span class="o">!=</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span> <span class="n">media</span><span class="o">*</span><span class="n">taper</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span> <span class="n">alpha</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">mu</span></div>

<span class="c1"># calculo matriz de covarianza</span>

<div class="viewcode-block" id="matriz_covarianza">
<a class="viewcode-back" href="../main.html#geostochpy.matriz_covarianza">[docs]</a>
<span class="k">def</span> <span class="nf">matriz_covarianza</span><span class="p">(</span> <span class="n">dip</span><span class="p">,</span> <span class="n">prof</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span> <span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    calcula la matriz de correlacion:</span>
<span class="sd">    Cij = exp(-(dstrike(i,j)/rstrike)-(ddip(i,j)/rdip)</span>
<span class="sd">    donde:</span>
<span class="sd">    dstrike y ddip son estimados de las distancias entre las subfallas i &amp; j</span>
<span class="sd">    ddip = dprof/sin(dip)</span>
<span class="sd">    d es la distancia euclidiana entre dos puntos aproximada segun sus lats y lons</span>
<span class="sd">    rstrike y rdip son los largos de correlacion en cada direccion </span>
<span class="sd">    Entradas: </span>
<span class="sd">    dip: matriz con los dips de cada punto</span>
<span class="sd">    prof: matriz con las profundidades de cada punto</span>
<span class="sd">    lons: matriz con longitud de cada subfalla, necesaria para el calculo de las distancias entre estas</span>
<span class="sd">    lats: matriz con latitud de cada subfalla, necesaria para el calculo de las distancias entre estas</span>
<span class="sd">    Observacion: en esta primera instancia se considera la aproximacion  1 grado approx 111.12 km (generalizar para fallas mas grandes)</span>
<span class="sd">    Observacion 2: aproximacion para calculo de distancia corregida con calculo geodesico de distancia (aumenta el costo computacional bastante)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">maxlat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="c1"># latitud maxima</span>
    <span class="n">lon_maxlat</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">lats</span> <span class="o">==</span> <span class="n">maxlat</span> <span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">lats</span> <span class="o">==</span> <span class="n">maxlat</span> <span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="c1"># longitud correspondiente a la latitud maxima</span>
    <span class="n">minlat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="c1"># latitud minima</span>
    <span class="n">lon_minlat</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">lats</span> <span class="o">==</span> <span class="n">minlat</span> <span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">lats</span> <span class="o">==</span> <span class="n">minlat</span> <span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="c1"># longitud correspondiente a la latitud minima</span>
    <span class="n">maxlon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="c1"># longitud maxima</span>
    <span class="n">lat_maxlon</span> <span class="o">=</span> <span class="n">lats</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">lons</span> <span class="o">==</span> <span class="n">maxlon</span> <span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">lons</span> <span class="o">==</span> <span class="n">maxlon</span> <span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="c1"># latitud correspondiente a la longitud maxima</span>
    <span class="n">minlon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="c1"># longitud minima</span>
    <span class="n">lat_minlon</span> <span class="o">=</span> <span class="n">lats</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">lons</span> <span class="o">==</span> <span class="n">minlon</span> <span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">lons</span> <span class="o">==</span> <span class="n">minlon</span> <span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">maxprof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">prof</span><span class="p">)</span> <span class="c1"># profundidad maxima</span>
    <span class="n">minprof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">prof</span><span class="p">)</span> <span class="c1"># profundidad minima</span>
    
    <span class="n">largo_falla</span> <span class="o">=</span> <span class="n">dist_sf</span><span class="p">(</span> <span class="n">lon_minlat</span><span class="p">,</span> <span class="n">lon_maxlat</span><span class="p">,</span> <span class="n">minlat</span><span class="p">,</span> <span class="n">maxlat</span> <span class="p">)</span> <span class="c1"># largo de la falla en metros</span>
    <span class="c1">#ancho_falla = np.sqrt((np.max(prof)-np.min(prof))**2+(abs(np.max(lons)-np.min(lons))*111000.12)**2)</span>
    <span class="n">ancho_falla</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span> <span class="n">prof</span> <span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span> <span class="n">prof</span> <span class="p">)</span> <span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dist_sf</span><span class="p">(</span> <span class="n">maxlon</span><span class="p">,</span> <span class="n">minlon</span><span class="p">,</span> <span class="n">lat_maxlon</span><span class="p">,</span> <span class="n">lat_minlon</span> <span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
    <span class="n">rdip</span> <span class="o">=</span> <span class="mf">0.4</span><span class="o">*</span><span class="n">ancho_falla</span> <span class="c1"># largo de correlacion en direccion de dip</span>
    <span class="n">rstrike</span> <span class="o">=</span> <span class="mf">0.4</span><span class="o">*</span><span class="n">largo_falla</span> <span class="c1"># largo de correlacion en direccion de strike</span>
    <span class="n">n_filas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span> <span class="n">prof</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># dimension 0</span>
    <span class="n">n_columnas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span> <span class="n">prof</span> <span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># dimension 1</span>
    <span class="n">vector_dip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span> <span class="n">dip</span><span class="p">,</span> <span class="p">(</span> <span class="n">n_filas</span> <span class="o">*</span> <span class="n">n_columnas</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">)</span>
    <span class="n">vector_prof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span> <span class="n">prof</span><span class="p">,</span> <span class="p">(</span> <span class="n">n_filas</span> <span class="o">*</span> <span class="n">n_columnas</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">)</span>
    <span class="n">vector_lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span> <span class="n">lons</span><span class="p">,</span> <span class="p">(</span> <span class="n">n_filas</span> <span class="o">*</span> <span class="n">n_columnas</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">)</span>
    <span class="n">vector_lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span> <span class="n">lats</span><span class="p">,</span> <span class="p">(</span> <span class="n">n_filas</span> <span class="o">*</span> <span class="n">n_columnas</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">)</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="c1"># LeVeque et al 2016</span>

    <span class="c1"># calculo de ddip</span>
    <span class="n">ddip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">vector_dip</span> <span class="p">),</span> <span class="nb">len</span><span class="p">(</span> <span class="n">vector_dip</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="c1"># iniciacion matriz de distancia a lo largo de dip</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">vector_dip</span> <span class="p">)</span> <span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">vector_dip</span> <span class="p">)</span> <span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span> <span class="p">(</span> <span class="n">vector_dip</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">vector_dip</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="p">)</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ddip</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="n">vector_prof</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">vector_prof</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span> <span class="p">(</span> <span class="n">vector_dip</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">vector_dip</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="p">)</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ddip</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># calculo de dstrike</span>
    <span class="n">dstrike</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">vector_prof</span> <span class="p">),</span> <span class="nb">len</span><span class="p">(</span> <span class="n">vector_prof</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="c1"># iniciacion matriz de distancia a lo largo de strike</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">vector_prof</span> <span class="p">),</span> <span class="nb">len</span><span class="p">(</span> <span class="n">vector_prof</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="c1"># iniciacion matriz de distancia entre fallas</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">vector_prof</span> <span class="p">)</span> <span class="p">):</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">vector_prof</span> <span class="p">)</span> <span class="p">):</span>
            <span class="c1">#d[k][l] = dist_sf(vector_lat[k],vector_lat[l],vector_lon[k],vector_lon[l])</span>
            <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist_sf_alt</span><span class="p">(</span> <span class="n">vector_lon</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">vector_lon</span><span class="p">[</span><span class="n">l</span><span class="p">],</span> <span class="n">vector_lat</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">vector_lat</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="p">)</span>
            <span class="c1">#d[k][l] = np.sqrt((abs(vector_lon[k]-vector_lon[l])*111000.12)**2+(abs(vector_lat[k]-vector_lat[l])*111000.12)**2)</span>
            <span class="n">dstrike</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="nb">abs</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span> <span class="n">ddip</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">]</span> <span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> <span class="p">)</span>
    
    <span class="c1"># calculo de Cij</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">vector_dip</span> <span class="p">),</span> <span class="nb">len</span><span class="p">(</span> <span class="n">vector_dip</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="c1"># matriz de correlacion</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">vector_prof</span> <span class="p">)</span> <span class="p">):</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">vector_prof</span> <span class="p">)</span> <span class="p">):</span>
            <span class="n">C</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="o">-</span><span class="p">(</span> <span class="p">(</span> <span class="n">dstrike</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="p">)</span><span class="o">/</span><span class="n">rstrike</span> <span class="p">)</span><span class="o">-</span><span class="p">(</span> <span class="p">(</span> <span class="n">ddip</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="p">)</span><span class="o">/</span><span class="n">rdip</span> <span class="p">)</span> <span class="p">)</span>


    <span class="n">mat_cova</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span> <span class="n">alpha</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">C</span><span class="o">+</span><span class="mi">1</span> <span class="p">)</span> <span class="c1"># matriz de covarianza</span>

    <span class="k">return</span> <span class="n">mat_cova</span></div>


<span class="c1"># Matriz de covarianza_optimized</span>
<div class="viewcode-block" id="matriz_covarianza_optimized">
<a class="viewcode-back" href="../main.html#geostochpy.matriz_covarianza_optimized">[docs]</a>
<span class="k">def</span> <span class="nf">matriz_covarianza_optimized</span><span class="p">(</span> <span class="n">dip</span><span class="p">,</span> <span class="n">prof</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span><span class="n">largo_falla</span><span class="p">,</span><span class="n">ancho_falla</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span> <span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    calcula la matriz de correlacion:</span>
<span class="sd">    Cij = exp(-(dstrike(i,j)/rstrike)-(ddip(i,j)/rdip)</span>
<span class="sd">    donde:</span>
<span class="sd">    dstrike y ddip son estimados de las distancias entre las subfallas i &amp; j</span>
<span class="sd">    ddip = dprof/sin(dip)</span>
<span class="sd">    d es la distancia euclidiana entre dos puntos aproximada segun sus lats y lons</span>
<span class="sd">    rstrike y rdip son los largos de correlacion en cada direccion </span>
<span class="sd">    Entradas: </span>
<span class="sd">    dip: matriz con los dips de cada punto</span>
<span class="sd">    prof: matriz con las profundidades de cada punto</span>
<span class="sd">    lons: matriz con longitud de cada subfalla, necesaria para el calculo de las distancias entre estas</span>
<span class="sd">    lats: matriz con latitud de cada subfalla, necesaria para el calculo de las distancias entre estas</span>
<span class="sd">    Observacion: en esta primera instancia se considera la aproximacion  1 grado approx 111.12 km (generalizar para fallas mas grandes)</span>
<span class="sd">    Observacion 2: aproximacion para calculo de distancia corregida con calculo geodesico de distancia (aumenta el costo computacional bastante)</span>
<span class="sd">    Obeservacion 3: el ancho y largo de la falla debe ser en metros</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rdip</span> <span class="o">=</span> <span class="mf">0.4</span><span class="o">*</span><span class="n">ancho_falla</span> <span class="c1"># largo de correlacion en direccion de dip</span>
    <span class="n">rstrike</span> <span class="o">=</span> <span class="mf">0.4</span><span class="o">*</span><span class="n">largo_falla</span> <span class="c1"># largo de correlacion en direccion de strike</span>
    <span class="n">n_filas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span> <span class="n">prof</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># dimension 0</span>
    <span class="n">n_columnas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span> <span class="n">prof</span> <span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># dimension 1</span>
    <span class="c1"># Vectorizar cÃ¡lculos</span>
    <span class="n">vector_dip</span><span class="p">,</span> <span class="n">vector_prof</span><span class="p">,</span> <span class="n">vector_lon</span><span class="p">,</span> <span class="n">vector_lat</span> <span class="o">=</span> <span class="n">dip</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">prof</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">lons</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">lats</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">ddip</span> <span class="o">=</span> <span class="p">(</span><span class="n">vector_prof</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">-</span> <span class="n">vector_prof</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">((</span><span class="n">vector_dip</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">+</span> <span class="n">vector_dip</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
    <span class="c1"># Reemplazar infinitos y NaN por 0</span>
    <span class="n">ddip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">ddip</span><span class="p">,</span> <span class="n">nan</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">posinf</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">neginf</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="c1"># d</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">dist_haversine</span><span class="p">(</span> <span class="n">vector_lon</span><span class="p">,</span> <span class="n">vector_lon</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">vector_lat</span><span class="p">,</span> <span class="n">vector_lat</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span>

    <span class="n">dstrike</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">d</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">ddip</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="c1"># Calcular Cij de manera vectorizada</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">dstrike</span> <span class="o">/</span> <span class="n">rstrike</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">ddip</span> <span class="o">/</span> <span class="n">rdip</span><span class="p">)))</span>
    
    <span class="c1"># Matriz de covarianza</span>
    <span class="n">mat_cova</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">alpha</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">C</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mat_cova</span></div>


<span class="c1"># distribucion de slip</span>

<div class="viewcode-block" id="distribucion_slip">
<a class="viewcode-back" href="../main.html#geostochpy.distribucion_slip">[docs]</a>
<span class="k">def</span> <span class="nf">distribucion_slip</span><span class="p">(</span> <span class="n">C</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">N</span> <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calcula la distribucion de slip con la expansion de karhunen-loeve log-normal</span>
<span class="sd">    exp(mu)exp(sum(zk*sqrt(lambdak)*vk))</span>
<span class="sd">    Entradas: </span>
<span class="sd">    C: matriz de covarianza, se le calculan los eigenvalues y vectors</span>
<span class="sd">    mu: matriz con medias</span>
<span class="sd">    N: numero de modos a contar para la sumatoria</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">n_cols_cova</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span> <span class="n">C</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># C es una matriz cuadrada de dim x dim </span>

    <span class="n">dim_mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span> <span class="n">mu</span> <span class="p">)</span> <span class="c1"># dimensiones de mu, para volver a rearmar matriz de slip</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span> <span class="n">mu</span><span class="p">,</span> <span class="p">(</span> <span class="n">n_cols_cova</span><span class="p">,</span> <span class="p">)</span> <span class="p">)</span>
    <span class="c1"># se calculan los valores y vectores propios de la matriz de covarianza</span>
    <span class="n">eig_val</span><span class="p">,</span> <span class="n">eig_vecs</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span> <span class="n">C</span> <span class="p">)</span>
    <span class="n">eig_val</span> <span class="o">=</span> <span class="n">eig_val</span><span class="o">.</span><span class="n">real</span> <span class="c1"># valores propios (lambda_k)</span>
    <span class="n">eig_vecs</span> <span class="o">=</span> <span class="n">eig_vecs</span><span class="o">.</span><span class="n">real</span> <span class="c1"># vectores propios (v_k) (columnas de eig_vecs)</span>

    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_cols_cova</span> <span class="p">)</span> <span class="c1"># distribucion gaussiana aleatoria z~N(0,1)</span>

    <span class="c1"># iniciacion array de slip</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="p">(</span> <span class="n">n_cols_cova</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span> <span class="p">)</span> <span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
      <span class="n">S</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">eig_val</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">eig_vecs</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">mu</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">S</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span> <span class="n">S</span><span class="p">,</span> <span class="n">dim_mu</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">S</span></div>




<span class="c1"># calculo de magnitud</span>

<div class="viewcode-block" id="magnitud_momento">
<a class="viewcode-back" href="../main.html#geostochpy.magnitud_momento">[docs]</a>
<span class="k">def</span> <span class="nf">magnitud_momento</span><span class="p">(</span><span class="n">slip</span><span class="p">,</span> <span class="n">prof</span><span class="p">,</span> <span class="n">largo_subfalla</span><span class="p">,</span><span class="n">ancho_subfalla</span><span class="p">,</span><span class="n">prem</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calcula la magnitud de momento Mw de la distribucion de slip con la ecuacion</span>
<span class="sd">    Mw = 2/3log(Mo)-6.05</span>
<span class="sd">    donde Mo = mu * area de ruptura * slip</span>
<span class="sd">    Entradas: </span>
<span class="sd">    slip: corresponde a la distribucion de slip </span>
<span class="sd">    prof: matriz con profundidades</span>
<span class="sd">    lons: matriz con longitudes</span>
<span class="sd">    lats: matriz con latitudes</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#mu = 3*10**10 # rigidez en N/m</span>
    <span class="c1"># se estima el tiempo que tarda la ruptura, tau, para luego estimar la rigidez</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="n">tau_ruptura_BilekModel</span><span class="p">(</span> <span class="n">largo_subfalla</span><span class="p">,</span><span class="n">beta</span><span class="o">=</span><span class="mi">2500</span><span class="p">,</span><span class="n">prem</span><span class="o">=</span><span class="n">prem</span><span class="p">,</span><span class="n">profs</span><span class="o">=</span><span class="n">prof</span><span class="p">)</span>
    <span class="c1"># se estima la rigidez de la interfaz dependiendo de la profundidad</span>
    <span class="n">rigidez</span> <span class="o">=</span> <span class="n">estima_rigidez_BilekModel</span><span class="p">(</span> <span class="n">largo_subfalla</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span><span class="n">prem</span><span class="o">=</span><span class="n">prem</span><span class="p">,</span><span class="n">profs</span><span class="o">=</span><span class="n">prof</span> <span class="p">)</span>
    <span class="c1"># calculo Mo</span>
    <span class="c1">#</span>
    <span class="n">area_subfalla</span> <span class="o">=</span> <span class="n">largo_subfalla</span><span class="o">*</span><span class="n">ancho_subfalla</span>
    <span class="n">Mo</span> <span class="o">=</span> <span class="n">rigidez</span><span class="o">*</span><span class="n">area_subfalla</span><span class="o">*</span><span class="n">slip</span>
    <span class="n">Mo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Mo</span><span class="p">)</span>
    <span class="n">Mw</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">/</span><span class="mf">3.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Mo</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="mf">9.1</span>

    <span class="k">return</span> <span class="n">Mw</span><span class="p">,</span> <span class="n">area_subfalla</span><span class="p">,</span><span class="n">rigidez</span></div>


<span class="c1"># estima la magnitud de momento utilizando la rigidez obtenida del modelo PREM</span>

<span class="c1"># calcula la media de slip</span>
<div class="viewcode-block" id="media_slip">
<a class="viewcode-back" href="../main.html#geostochpy.media_slip">[docs]</a>
<span class="k">def</span> <span class="nf">media_slip</span><span class="p">(</span><span class="n">Mw</span><span class="p">,</span><span class="n">largo_subfalla</span><span class="p">,</span><span class="n">ancho_subfalla</span><span class="p">,</span><span class="n">prof</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Largo, ancho y profundidad deben estar en metros</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tau</span><span class="o">=</span><span class="n">tau_ruptura_BilekModel</span><span class="p">(</span> <span class="n">largo_subfalla</span><span class="p">,</span><span class="n">beta</span><span class="o">=</span><span class="mi">2500</span><span class="p">,</span><span class="n">prem</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">profs</span><span class="o">=</span><span class="n">prof</span><span class="p">)</span>
    <span class="n">rigidez</span><span class="o">=</span><span class="n">estima_rigidez_BilekModel</span><span class="p">(</span><span class="n">largo_subfalla</span><span class="p">,</span><span class="n">tau</span><span class="p">,</span><span class="n">prem</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">profs</span><span class="o">=</span><span class="n">prof</span><span class="p">)</span>
    <span class="n">Mo</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">Mw</span><span class="o">+</span><span class="mf">9.1</span><span class="p">)</span>
    <span class="n">matriz_area</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">prof</span><span class="p">)</span><span class="o">*</span><span class="n">largo_subfalla</span><span class="o">*</span><span class="n">ancho_subfalla</span>
    <span class="n">media_slip</span><span class="o">=</span><span class="n">Mo</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">matriz_area</span><span class="o">*</span><span class="n">rigidez</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">media_slip</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">matriz_area</span><span class="p">),</span><span class="n">rigidez</span></div>

<span class="c1"># escala la magnitud</span>
<div class="viewcode-block" id="escalar_magnitud_momento">
<a class="viewcode-back" href="../main.html#geostochpy.escalar_magnitud_momento">[docs]</a>
<span class="k">def</span> <span class="nf">escalar_magnitud_momento</span><span class="p">(</span><span class="n">Mw</span><span class="p">,</span> <span class="n">slip</span><span class="p">,</span> <span class="n">prof</span><span class="p">,</span> <span class="n">largo_subfalla</span><span class="p">,</span><span class="n">ancho_subfalla</span><span class="p">,</span><span class="n">prem</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Escala la distribucion de slip a la magnitud de momento deseada de entrada.</span>
<span class="sd">    crea una matriz de slip uniforme con magnitud de momento igual a la primitiva</span>
<span class="sd">    para normalizar el slip. Despues escala con matriz uniforme con magnitud de momento</span>
<span class="sd">    deseada</span>
<span class="sd">    Entradas:</span>
<span class="sd">    Mw: magnitud de momento deseada</span>
<span class="sd">    slip: distribucion &quot;primitiva&quot; de slip</span>
<span class="sd">    prof: matriz de profundidades de la interfaz</span>
<span class="sd">    lons: longitudes de las subfallas</span>
<span class="sd">    lats: latitudes de las subfallas</span>
<span class="sd">    observacion: los 4 ultimos argumentos son para calcular la magnitud de momento </span>
<span class="sd">    con la funcion &quot;magnitud_momento&quot; definida anteriormente</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># dimensiones array de slip</span>
    <span class="n">dims</span>                <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span> <span class="n">slip</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">prem</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>    
        <span class="n">Mw_prim</span><span class="p">,</span> <span class="n">areasf</span><span class="p">,</span><span class="n">rigidez</span> <span class="o">=</span> <span class="n">magnitud_momento</span><span class="p">(</span> <span class="n">slip</span><span class="p">,</span> <span class="n">prof</span><span class="p">,</span> <span class="n">largo_subfalla</span><span class="p">,</span><span class="n">ancho_subfalla</span><span class="p">,</span><span class="n">prem</span><span class="o">=</span><span class="kc">False</span> <span class="p">)</span> <span class="c1"># magnitud de momento de dist slip primitiva</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Mw_prim</span><span class="p">,</span> <span class="n">areasf</span><span class="p">,</span><span class="n">rigidez</span> <span class="o">=</span> <span class="n">magnitud_momento</span><span class="p">(</span> <span class="n">slip</span><span class="p">,</span> <span class="n">prof</span><span class="p">,</span> <span class="n">largo_subfalla</span><span class="p">,</span><span class="n">ancho_subfalla</span><span class="p">,</span><span class="n">prem</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span> <span class="c1"># magnitud de momento de dist slip primitiva</span>
    <span class="n">Mo_original</span>     <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="mf">3.</span><span class="o">/</span><span class="mf">2.</span> <span class="o">*</span>  <span class="n">Mw_prim</span> <span class="o">+</span> <span class="mf">9.1</span> <span class="p">)</span> <span class="c1"># momento de la distribucion original</span>
    <span class="n">Mo_deseado</span>      <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="mf">3.</span><span class="o">/</span><span class="mf">2.</span> <span class="o">*</span>  <span class="n">Mw</span> <span class="o">+</span> <span class="mf">9.1</span> <span class="p">)</span>  <span class="c1"># momento deseado para la magnitud a escalar</span>
    <span class="n">razon_Mo</span>        <span class="o">=</span> <span class="n">Mo_deseado</span><span class="o">/</span><span class="n">Mo_original</span> <span class="c1"># razones entre los momentos, se cancelan los otros factores que no sean slip (rigidez y area)</span>
    <span class="n">slip_escalado</span>   <span class="o">=</span> <span class="n">slip</span><span class="o">*</span><span class="n">razon_Mo</span>
    <span class="c1">#D_original = np.divide( ( Mo_original/n_subfallas ) * slip_prim_homogeneo, (rigidez*areasf)*np.ones( dims )   )</span>
    <span class="c1">#slip_prim_homogeneo = np.exp( ( 3.0/2.0 ) * ( Mw_prim+6.05 ) )/area_falla # array de slip homogeneo con Mw primitiva</span>
    <span class="c1">#slip_norm = np.divide( slip, slip_prim_homogeneo ) # array slip normalizado por slip con Mw primitiva</span>
    <span class="c1">#slip_deseado_homogeneo = np.exp( ( 3.0/2.0 ) * ( Mw + 6.05 ) )/area_falla # array de slip homogeneo con Mw deseado</span>
    <span class="c1">#slip_escalado = np.multiply(slip_norm, slip_deseado_homogeneo)</span>
    <span class="k">return</span> <span class="n">slip_escalado</span><span class="p">,</span><span class="n">rigidez</span><span class="p">,</span><span class="n">Mo_original</span><span class="p">,</span><span class="n">Mo_deseado</span></div>



<div class="viewcode-block" id="corr2d_fourier">
<a class="viewcode-back" href="../main.html#geostochpy.corr2d_fourier">[docs]</a>
<span class="k">def</span> <span class="nf">corr2d_fourier</span><span class="p">(</span><span class="n">slip</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">lonslip</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">latslip</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">lontest</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">lattest</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">normalizar</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calcula la correlacion cruzada entre 2 arrays 2d utilizando el metodo de la </span>
<span class="sd">    transformada rapida de fourier para obtener indices para filtrar</span>
<span class="sd">    Entradas:</span>
<span class="sd">    slip: array que contiene el slip generado</span>
<span class="sd">    test: arrray de prueba con el cual se busca realzar el filtro (e.g.: anom. de gravedad)</span>
<span class="sd">    lonslip, latslip: longitud y latitud de las subfallas que componen el slip</span>
<span class="sd">    lontest, lattest: longitud y latitud de las subfallas que componen el test</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">if</span> <span class="n">normalizar</span><span class="p">:</span> 
        <span class="n">xcorr2d</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">slip</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">slip</span><span class="p">),</span> <span class="n">test</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">test</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;fft&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xcorr2d</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">slip</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;fft&#39;</span><span class="p">)</span>
    
    
    <span class="n">valor_corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xcorr2d</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">valor_corr</span></div>


<div class="viewcode-block" id="sigmoid">
<a class="viewcode-back" href="../main.html#geostochpy.sigmoid">[docs]</a>
<span class="k">def</span> <span class="nf">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Funcion auxiliar para crear ventana sigmoidal para el taper</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">),))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
        <span class="n">S</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">S</span></div>

<span class="c1"># calculo laplaciano para estudiar la suavidad</span>

<div class="viewcode-block" id="calcula_laplaciano">
<a class="viewcode-back" href="../main.html#geostochpy.calcula_laplaciano">[docs]</a>
<span class="k">def</span> <span class="nf">calcula_laplaciano</span><span class="p">(</span><span class="n">tamano_sf</span><span class="p">,</span><span class="n">F</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Entradas </span>
<span class="sd">    tamano_sf: tamano subfalla</span>
<span class="sd">    F: Campo escalar a calcularle el laplaciano</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tamano_sf</span><span class="p">)</span>

    <span class="n">laplaciano</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">laplace</span><span class="p">(</span><span class="n">F</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;wrap&quot;</span><span class="p">)</span>
    <span class="n">sum_lap</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">laplaciano</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">sum_lap</span></div>


<span class="c1"># calculo de la cantidad maxima de valores y vectores propios a utilizarse</span>

<div class="viewcode-block" id="N_max_matriz_covarianza">
<a class="viewcode-back" href="../main.html#geostochpy.N_max_matriz_covarianza">[docs]</a>
<span class="k">def</span> <span class="nf">N_max_matriz_covarianza</span><span class="p">(</span><span class="n">C</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Busca la esquina de la curva l de los valores propios</span>
<span class="sd">    Entrada:</span>
<span class="sd">    C : matriz de covarianza de la falla</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># valores auxiliares</span>
    <span class="n">n_filas_cova</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span> <span class="n">C</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">n_cols_cova</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span> <span class="n">C</span> <span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># valores y vectores propios</span>
    <span class="n">eig_val</span><span class="p">,</span> <span class="n">eig_vec</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span> <span class="n">C</span> <span class="p">)</span>
    <span class="n">eig_vals</span>         <span class="o">=</span> <span class="n">eig_val</span><span class="o">.</span><span class="n">real</span> <span class="c1"># valores propios (lambda_k)</span>
    <span class="n">eig_vecs</span>         <span class="o">=</span> <span class="n">eig_vec</span><span class="o">.</span><span class="n">real</span> <span class="c1"># vectores propios (v_k) (columnas de eig_vecs)</span>
    <span class="c1"># vector con indices de valores propios</span>
    <span class="n">idx_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">eig_vals</span><span class="p">)))</span>
    <span class="c1"># transformamos los valores propios y los indices a un espacio log-log</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">idx_vec</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">eig_vals</span><span class="p">)</span>
    <span class="c1"># Triangular/circumscribed circle simple approximation to curvature </span>
    <span class="c1"># (after Roger Stafford)</span>

    <span class="c1"># the series of points used for the triangle/circle</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">x3</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">y3</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>

    <span class="c1"># the side lengths for each triangle</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">x3</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">y3</span><span class="o">-</span><span class="n">y2</span><span class="p">))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">x1</span><span class="o">-</span><span class="n">x3</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">y1</span><span class="o">-</span><span class="n">y3</span><span class="p">))</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">x2</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">y2</span><span class="o">-</span><span class="n">y1</span><span class="p">))</span>
    <span class="c1"># semi perimetro</span>
    <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
    <span class="c1"># radio de cada circulo</span>
    <span class="n">R</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="n">c</span><span class="p">))))</span>
    <span class="c1"># The curvature for each estimate for each value which is</span>
    <span class="c1"># the reciprocal of its circumscribed radius. Since there aren&#39;t circles for </span>
    <span class="c1"># the end points they have no curvature</span>
    <span class="n">kappa</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n_filas_cova</span><span class="p">))</span>
    <span class="n">kappa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>    <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">kappa</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>   <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">kappa</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reciprocal</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
    <span class="n">idx_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">kappa</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">kappa</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">idx_max</span></div>


<div class="viewcode-block" id="km2deg">
<a class="viewcode-back" href="../main.html#geostochpy.km2deg">[docs]</a>
<span class="k">def</span> <span class="nf">km2deg</span><span class="p">(</span><span class="n">km</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">km</span><span class="o">/</span><span class="mf">111.1</span></div>

<span class="c1">#</span>
<div class="viewcode-block" id="deg2km">
<a class="viewcode-back" href="../main.html#geostochpy.deg2km">[docs]</a>
<span class="k">def</span> <span class="nf">deg2km</span><span class="p">(</span><span class="n">deg</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">deg</span><span class="o">*</span><span class="mf">111.1</span><span class="p">)</span></div>

<span class="c1"># based in Melgar and Hayes 2017. along strike and along-dip values</span>
<div class="viewcode-block" id="nearest_value">
<a class="viewcode-back" href="../main.html#geostochpy.nearest_value">[docs]</a>
<span class="k">def</span> <span class="nf">nearest_value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">matrix</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">matrix</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">matrix</span> <span class="o">-</span> <span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]</span></div>


<div class="viewcode-block" id="hypocenter">
<a class="viewcode-back" href="../main.html#geostochpy.hypocenter">[docs]</a>
<span class="k">def</span> <span class="nf">hypocenter</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span><span class="n">lats</span><span class="p">,</span><span class="n">depth</span><span class="p">,</span><span class="n">length</span><span class="p">,</span><span class="n">width</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a random hypocenter from a given grid .</span>

<span class="sd">    :param lons: [description]</span>
<span class="sd">    :type lons: [type]</span>
<span class="sd">    :param lats: [description]</span>
<span class="sd">    :type lats: [type]</span>
<span class="sd">    :param depth: [description]</span>
<span class="sd">    :type depth: [type]</span>
<span class="sd">    :param length: [description]</span>
<span class="sd">    :type length: [type]</span>
<span class="sd">    :param width: [description]</span>
<span class="sd">    :type width: [type]</span>
<span class="sd">    :return: [description]</span>
<span class="sd">    :rtype: [type]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># along dip normal pdf parameters</span>
    <span class="n">mu</span><span class="o">=</span><span class="mf">0.046</span>
    <span class="n">sigma</span><span class="o">=</span><span class="mf">0.208</span>
    <span class="c1"># along strike exponential pdf parameters</span>
    <span class="n">lamda</span><span class="o">=</span><span class="mf">5.435</span>
    <span class="c1">#</span>
    <span class="n">along_dip</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="n">sigma</span><span class="p">)</span>
    <span class="n">along_strike</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">lamda</span><span class="p">)</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">along_dip</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">along_dip</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">):</span>
        <span class="n">along_dip</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="n">sigma</span><span class="p">)</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">along_strike</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">along_strike</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">along_strike</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">lamda</span><span class="p">)</span>
    <span class="c1"># once computed a random value for each component, its neccesary </span>
    <span class="c1"># transform to lat and lon hypocenter.</span>

    <span class="n">L</span><span class="o">=</span><span class="n">along_strike</span><span class="o">*</span><span class="n">length</span> <span class="c1"># linear regression</span>
    <span class="n">W</span><span class="o">=</span><span class="n">along_dip</span><span class="o">*</span><span class="n">width</span><span class="o">+</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># linear regression</span>
    <span class="n">flag</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># if its 0, the hypocenter will to north of fault</span>
    <span class="c1"># else, to south</span>
    <span class="n">middle</span><span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lats</span><span class="p">[:])</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lats</span><span class="p">[:]))</span><span class="o">/</span><span class="mi">2</span>
    <span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">y</span><span class="o">=</span><span class="n">middle</span><span class="o">+</span><span class="n">km2deg</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
        <span class="n">nearest_y_pos</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">lats</span><span class="o">==</span><span class="n">nearest_value</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">lats</span><span class="p">[:]))</span>
        <span class="n">x_min</span><span class="o">=</span><span class="n">lons</span><span class="p">[</span><span class="n">nearest_y_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># catch the first column</span>
        <span class="n">x</span><span class="o">=</span><span class="n">x_min</span><span class="o">+</span><span class="n">km2deg</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
        <span class="n">nearest_x_pos</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">lons</span><span class="o">==</span><span class="n">nearest_value</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">lons</span><span class="p">[:]))</span>
        <span class="n">z</span><span class="o">=</span><span class="n">depth</span><span class="p">[</span><span class="n">nearest_x_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="n">nearest_x_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y</span><span class="o">=</span><span class="n">middle</span><span class="o">-</span><span class="n">km2deg</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
        <span class="n">nearest_y_pos</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">lats</span><span class="o">==</span><span class="n">nearest_value</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">lats</span><span class="p">[:]))</span>
        <span class="n">x_min</span><span class="o">=</span><span class="n">lons</span><span class="p">[</span><span class="n">nearest_y_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">x</span><span class="o">=</span><span class="n">x_min</span><span class="o">+</span><span class="n">km2deg</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
        <span class="n">nearest_x_pos</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">lons</span><span class="o">==</span><span class="n">nearest_value</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">lons</span><span class="p">[:]))</span>
        <span class="n">z</span><span class="o">=</span><span class="n">depth</span><span class="p">[</span><span class="n">nearest_x_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="n">nearest_x_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">hypocenter</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">hypocenter</span></div>

<span class="c1">################ FILTER FUNCTIONS</span>
<span class="c1"># crea ventana para hacerle un taper al patron de slip</span>
<div class="viewcode-block" id="ventana_taper_slip_fosa">
<a class="viewcode-back" href="../main.html#geostochpy.ventana_taper_slip_fosa">[docs]</a>
<span class="k">def</span> <span class="nf">ventana_taper_slip_fosa</span><span class="p">(</span> <span class="n">Slip</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">ventana_flag</span> <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Crea una ventana para aplicar un taper al slip en cercanias de la fosa</span>
<span class="sd">    Entradas:</span>
<span class="sd">    Slip: array con los valores de slip por subfalla</span>
<span class="sd">    lon: array de longitudes de las subfallas</span>
<span class="sd">    lat: array con las latitudes de las subfallas</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># valores auxiliares</span>

    <span class="n">n_subfallas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">Slip</span><span class="p">)</span>
    <span class="n">n_lons</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Slip</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">n_lats</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Slip</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ventana</span>     <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># seleccionar la ventana</span>
    <span class="c1"># 1: tukey</span>
    <span class="c1"># 2: gauss</span>
    <span class="c1"># 3: hanning</span>
    <span class="c1"># 4: hamming</span>

    <span class="k">if</span>   <span class="n">ventana_flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ventana</span>     <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">tukey</span><span class="p">(</span><span class="n">n_lons</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">ventana_flag</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">ventana</span>     <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">gaussian</span><span class="p">(</span><span class="n">n_lons</span><span class="p">,</span><span class="n">std</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">ventana_flag</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">ventana</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hanning</span><span class="p">(</span><span class="n">n_lons</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">ventana_flag</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">ventana</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hamming</span><span class="p">(</span><span class="n">n_lons</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">ventana_flag</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="n">n_lons</span><span class="p">)</span>
        <span class="n">ventana</span>     <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

        
    <span class="n">ventana</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n_lons</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span><span class="n">n_lons</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ventana</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">ventana</span><span class="p">,(</span><span class="n">n_lats</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">ventana</span></div>



<span class="c1"># crea el taper al patron de slip a partir de la ventana creada con la funcion ventana_taper_slip_fosa()</span>
<div class="viewcode-block" id="taper_borders">
<a class="viewcode-back" href="../main.html#geostochpy.taper_borders">[docs]</a>
<span class="k">def</span> <span class="nf">taper_borders</span><span class="p">(</span><span class="n">Slip</span><span class="p">,</span><span class="n">taperfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hanning</span><span class="p">):</span>
    <span class="n">filas</span><span class="p">,</span> <span class="n">columnas</span> <span class="o">=</span> <span class="n">Slip</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">ventana_filas</span> <span class="o">=</span> <span class="n">taperfunc</span><span class="p">(</span><span class="n">filas</span><span class="p">)</span>
    <span class="n">ventana_columnas</span> <span class="o">=</span> <span class="n">taperfunc</span><span class="p">(</span><span class="n">columnas</span><span class="p">)</span>
    <span class="n">taper_2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">ventana_filas</span><span class="p">,</span> <span class="n">ventana_columnas</span><span class="p">)</span>
    <span class="n">Slip_taper</span> <span class="o">=</span> <span class="n">Slip</span> <span class="o">*</span> <span class="n">taper_2d</span>

    <span class="k">return</span> <span class="n">Slip_taper</span></div>

<div class="viewcode-block" id="taper_except_trench">
<a class="viewcode-back" href="../main.html#geostochpy.taper_except_trench">[docs]</a>
<span class="k">def</span> <span class="nf">taper_except_trench</span><span class="p">(</span><span class="n">Slip</span><span class="p">,</span><span class="n">taperfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hanning</span><span class="p">):</span>
    <span class="n">filas</span><span class="p">,</span> <span class="n">columnas</span> <span class="o">=</span> <span class="n">Slip</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">ventana_filas</span> <span class="o">=</span> <span class="n">taperfunc</span><span class="p">(</span><span class="n">filas</span><span class="p">)</span>
    <span class="n">ventana_columnas</span> <span class="o">=</span> <span class="n">taperfunc</span><span class="p">(</span><span class="n">columnas</span><span class="p">)</span>
    <span class="c1"># ventana_columnas[0:int(columnas)//2] = np.linspace(0.2,1,np.size(ventana_columnas[0:int(columnas)//2]))</span>
    <span class="n">ventana_columnas</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">columnas</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">taper_2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">ventana_filas</span><span class="p">,</span> <span class="n">ventana_columnas</span><span class="p">)</span>
    <span class="n">Slip_taper</span> <span class="o">=</span> <span class="n">Slip</span> <span class="o">*</span> <span class="n">taper_2d</span>

    <span class="k">return</span> <span class="n">Slip_taper</span></div>

<div class="viewcode-block" id="taper_slip_fosa">
<a class="viewcode-back" href="../main.html#geostochpy.taper_slip_fosa">[docs]</a>
<span class="k">def</span> <span class="nf">taper_slip_fosa</span><span class="p">(</span><span class="n">Slip</span><span class="p">,</span> <span class="n">ventana</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Aplica un taper para atenuar el slip en las cercanias de la fosa</span>
<span class="sd">    Entradas:</span>
<span class="sd">    Slip: array con los valores de slip por subfalla</span>
<span class="sd">    ventana: ventana a usarse para aplicar el taper</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># valores auxiliares</span>
    <span class="n">n_subfallas</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">Slip</span><span class="p">)</span>
    <span class="n">n_lons</span>         <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Slip</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">n_lats</span>         <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Slip</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">tamano_ventana</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ventana</span><span class="p">)</span>
    <span class="n">tamano_slip</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Slip</span><span class="p">)</span>

    <span class="c1"># se asegura que la ventana tenga el mismo tamagno que el slip</span>
    <span class="k">assert</span> <span class="n">tamano_ventana</span> <span class="o">==</span> <span class="n">tamano_slip</span><span class="p">,</span> <span class="s2">&quot;ventana mal creada&quot;</span>

    <span class="n">tapered_slip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">Slip</span><span class="p">,</span><span class="n">ventana</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">tapered_slip</span></div>

<span class="c1"># FILTER ALONG DIP IN SUBDUCTION ZONE ()</span>
<div class="viewcode-block" id="tukey_window">
<a class="viewcode-back" href="../main.html#geostochpy.tukey_window">[docs]</a>
<span class="k">def</span> <span class="nf">tukey_window</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Genera una ventana Tukey.Se ha</span>
<span class="sd">    ajustado los valores de la parte de Hann para que no alcancen completamente cero al comienzo</span>

<span class="sd">    ParÃ¡metros:</span>
<span class="sd">    - N: Longitud de la ventana.</span>
<span class="sd">    - alpha: ParÃ¡metro de apertura (0 para una ventana rectangular, 1 para una ventana Hann).</span>

<span class="sd">    Retorna:</span>
<span class="sd">    - Ventana Tukey.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">alpha</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">alpha</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hanning</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="c1"># Aplica la parte de la ventana Hann</span>
        <span class="n">first_condition</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">last_condition</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">w</span><span class="p">[</span><span class="n">first_condition</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">first_condition</span><span class="p">]</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)))</span>
        <span class="n">w</span><span class="p">[</span><span class="n">last_condition</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Ajusta los valores para que no alcancen completamente cero al comienzo y al final</span>
        <span class="n">w</span><span class="p">[</span><span class="n">first_condition</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">w</span><span class="p">[</span><span class="n">first_condition</span><span class="p">]</span>
        <span class="n">w</span><span class="p">[</span><span class="n">last_condition</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">w</span><span class="p">[</span><span class="n">last_condition</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">w</span></div>

<div class="viewcode-block" id="tukey_window_equal">
<a class="viewcode-back" href="../main.html#geostochpy.tukey_window_equal">[docs]</a>
<span class="k">def</span> <span class="nf">tukey_window_equal</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Genera una ventana Tukey.Se ha</span>
<span class="sd">    ajustado los valores de la parte de Hann para que no alcancen completamente cero al comienzo</span>

<span class="sd">    ParÃ¡metros:</span>
<span class="sd">    - N: Longitud de la ventana.</span>
<span class="sd">    - alpha: ParÃ¡metro de apertura (0 para una ventana rectangular, 1 para una ventana Hann).</span>

<span class="sd">    Retorna:</span>
<span class="sd">    - Ventana Tukey.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">alpha</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">alpha</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hanning</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="c1"># Aplica la parte de la ventana Hann</span>
        <span class="n">first_condition</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">last_condition</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">w</span><span class="p">[</span><span class="n">first_condition</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">first_condition</span><span class="p">]</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)))</span>
        <span class="n">w</span><span class="p">[</span><span class="n">last_condition</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">last_condition</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)))</span>

        <span class="c1"># Ajusta los valores para que no alcancen completamente cero al comienzo y al final</span>
        <span class="n">w</span><span class="p">[</span><span class="n">first_condition</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">w</span><span class="p">[</span><span class="n">first_condition</span><span class="p">]</span>
        <span class="n">w</span><span class="p">[</span><span class="n">last_condition</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">w</span><span class="p">[</span><span class="n">last_condition</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">w</span></div>

<div class="viewcode-block" id="taper_except_trench_tukey">
<a class="viewcode-back" href="../main.html#geostochpy.taper_except_trench_tukey">[docs]</a>
<span class="k">def</span> <span class="nf">taper_except_trench_tukey</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span><span class="n">dip_taperfunc</span><span class="o">=</span><span class="n">tukey_window</span><span class="p">,</span><span class="n">strike_taperfunc</span><span class="o">=</span><span class="n">tukey_window_equal</span><span class="p">,</span><span class="n">alpha_dip</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">alpha_strike</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    2-D Taper to a Slip. Tukey windows along the strike and along the dip.</span>

<span class="sd">    :param Slip: [description]</span>
<span class="sd">    :type Slip: [type]</span>
<span class="sd">    :param dip_taperfunc: [description], defaults to tukey_window</span>
<span class="sd">    :type dip_taperfunc: [type], optional</span>
<span class="sd">    :param strike_taperfunc: [description], defaults to windows.tukey</span>
<span class="sd">    :type strike_taperfunc: [type], optional</span>
<span class="sd">    :param alpha_dip: [description], defaults to 0.5</span>
<span class="sd">    :type alpha_dip: float, optional</span>
<span class="sd">    :param alpha_strike: [description], defaults to 0.5</span>
<span class="sd">    :type alpha_strike: float, optional</span>
<span class="sd">    :return: [description]</span>
<span class="sd">    :rtype: [type]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filas</span><span class="p">,</span> <span class="n">columnas</span> <span class="o">=</span> <span class="n">depth</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">ventana_filas</span> <span class="o">=</span> <span class="n">strike_taperfunc</span><span class="p">(</span><span class="n">filas</span><span class="p">,</span><span class="n">alpha_strike</span><span class="p">)</span>
    <span class="n">ventana_columnas</span> <span class="o">=</span> <span class="n">dip_taperfunc</span><span class="p">(</span><span class="n">columnas</span><span class="p">,</span><span class="n">alpha_dip</span><span class="p">)</span>
    <span class="c1"># ventana_columnas[0:int(columnas)//2] = np.linspace(0.2,1,np.size(ventana_columnas[0:int(columnas)//2]))</span>
    <span class="c1"># ventana_columnas[0:int(columnas)//2] = 1</span>
    <span class="n">taper_2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">ventana_filas</span><span class="p">,</span> <span class="n">ventana_columnas</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">taper_2d</span> <span class="c1">#Slip_taper, taper_2d</span></div>

<span class="c1">################ PLOT FUNCTIONS</span>
<span class="k">def</span> <span class="nf">plot_grid</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="n">data_trench</span><span class="p">,</span><span class="n">lons</span><span class="p">,</span><span class="n">lats</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a grid of regions in a region of land .</span>

<span class="sd">    :param region: [description]</span>
<span class="sd">    :type region: [type]</span>
<span class="sd">    :param data_trench: [description]</span>
<span class="sd">    :type data_trench: [type]</span>
<span class="sd">    :param lons: [description]</span>
<span class="sd">    :type lons: [type]</span>
<span class="sd">    :param lats: [description]</span>
<span class="sd">    :type lats: [type]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># plotting grid</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">pygmt</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="c1"># Chilean trench</span>
    <span class="c1"># Load sample grid (3 arc-minutes global relief) in target area</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">pygmt</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">load_earth_relief</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="s2">&quot;30s&quot;</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">)</span>
    <span class="c1"># Plot original grid</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">basemap</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;M0/0/12c&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">grdimage</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="n">grid</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;oleron&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data_trench</span><span class="p">,</span>
        <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span>
        <span class="n">pen</span><span class="o">=</span><span class="s2">&quot;0.2p&quot;</span><span class="p">,</span>
        <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
        <span class="n">style</span><span class="o">=</span><span class="s2">&quot;f0.5i/0.1i+r+t+o1&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">lons</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">lats</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;p0.2c&quot;</span><span class="p">,</span> <span class="n">pen</span><span class="o">=</span><span class="s2">&quot;2p,red&quot;</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span>
    <span class="c1"># Place the colorbar inside the plot (lower-case &quot;j&quot;) with justification</span>
    <span class="c1"># Bottom Right and an offset (&quot;+o&quot;) of 0.7 centimeters and</span>
    <span class="c1"># 0.3 centimeters in x or y directions, respectively</span>
    <span class="c1"># Move the x label above the horizontal colorbar (&quot;+ml&quot;)</span>
    <span class="n">position</span><span class="o">=</span><span class="s2">&quot;jBR+o0.7c/0.8c+h+w5c/0.3c+ml&quot;</span><span class="p">,</span>
    <span class="c1"># Add a box around the colobar with a fill (&quot;+g&quot;) in &quot;white&quot; color and</span>
    <span class="c1"># a transparency (&quot;@&quot;) of 30 % and with a 0.8-points thick black</span>
    <span class="c1"># outline (&quot;+p&quot;)</span>
    <span class="n">box</span><span class="o">=</span><span class="s2">&quot;+gwhite@30+p0.8p,black&quot;</span><span class="p">,</span>
    <span class="c1"># Add x and y labels (&quot;+l&quot;)</span>
    <span class="n">frame</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x+lElevation&quot;</span><span class="p">,</span> <span class="s2">&quot;y+lm&quot;</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;grid.png&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span>
<div class="viewcode-block" id="plot_slip">
<a class="viewcode-back" href="../main.html#geostochpy.plot_slip">[docs]</a>
<span class="k">def</span> <span class="nf">plot_slip</span><span class="p">(</span><span class="n">X_grid</span><span class="p">,</span><span class="n">Y_grid</span><span class="p">,</span><span class="n">lonfosa</span><span class="p">,</span><span class="n">latfosa</span><span class="p">,</span><span class="n">Slip</span><span class="p">,</span><span class="n">filename</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">):</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="c1"># iniciliazar mapa</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;merc&#39;</span><span class="p">,</span> <span class="n">lat_0</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span> <span class="n">lon_0</span><span class="o">=</span><span class="mi">210</span><span class="p">,</span>
            <span class="n">resolution</span> <span class="o">=</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span>
            <span class="n">llcrnrlon</span><span class="o">=-</span><span class="mi">78</span><span class="p">,</span> <span class="n">llcrnrlat</span><span class="o">=-</span><span class="mi">38</span><span class="p">,</span>
            <span class="n">urcrnrlon</span><span class="o">=-</span><span class="mi">68</span><span class="p">,</span> <span class="n">urcrnrlat</span><span class="o">=-</span><span class="mi">28</span><span class="p">)</span>
        <span class="c1"># transformar coordenadas geograficas a coord de mapa</span>
        <span class="n">mlons</span><span class="p">,</span> <span class="n">mlats</span>         <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">X_grid</span><span class="p">,</span><span class="n">Y_grid</span><span class="p">)</span>
        <span class="n">mfosalons</span><span class="p">,</span> <span class="n">mfosalats</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">lonfosa</span><span class="p">,</span> <span class="n">latfosa</span><span class="p">)</span>
        <span class="c1"># anexos</span>
        <span class="n">m</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mfosalons</span><span class="p">,</span> <span class="n">mfosalats</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">drawcoastlines</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">drawcountries</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">fillcontinents</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">lake_color</span><span class="o">=</span><span class="s1">&#39;aqua&#39;</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">drawmapboundary</span><span class="p">(</span><span class="n">fill_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
        <span class="c1"># m.drawmeridians(np.arange(-180,180,2),labels=[1,1,0,1])</span>
        <span class="c1"># m.drawparallels(np.arange(-50,-30,2),labels=[1,1,0,1])</span>
        <span class="n">m</span><span class="o">.</span><span class="n">drawparallels</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="o">-</span><span class="mi">25</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">m</span><span class="o">.</span><span class="n">drawmeridians</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">68</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># promedio</span>
        <span class="n">my_cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
        <span class="n">csave</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">mlons</span><span class="p">,</span> <span class="n">mlats</span><span class="p">,</span> <span class="n">Slip</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">my_cmap</span><span class="p">,</span><span class="n">shading</span><span class="o">=</span><span class="s1">&#39;gouraud&#39;</span><span class="p">)</span>
        <span class="n">cbar</span>     <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">csave</span><span class="p">,</span><span class="n">location</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Slip [m]&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">fig</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="plot_slip_gmt">
<a class="viewcode-back" href="../main.html#geostochpy.plot_slip_gmt">[docs]</a>
<span class="k">def</span> <span class="nf">plot_slip_gmt</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="n">X_grid</span><span class="p">,</span><span class="n">Y_grid</span><span class="p">,</span><span class="n">lonfosa</span><span class="p">,</span><span class="n">latfosa</span><span class="p">,</span><span class="n">Slip</span><span class="p">,</span><span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a Slip grid of data on a grid</span>

<span class="sd">    :param region: [description]</span>
<span class="sd">    :type region: [type]</span>
<span class="sd">    :param X_grid: [description]</span>
<span class="sd">    :type X_grid: [type]</span>
<span class="sd">    :param Y_grid: [description]</span>
<span class="sd">    :type Y_grid: [type]</span>
<span class="sd">    :param lonfosa: [description]</span>
<span class="sd">    :type lonfosa: [type]</span>
<span class="sd">    :param latfosa: [description]</span>
<span class="sd">    :type latfosa: [type]</span>
<span class="sd">    :param Slip: [description]</span>
<span class="sd">    :type Slip: [type]</span>
<span class="sd">    :param dx: [description]</span>
<span class="sd">    :type dx: [type]</span>
<span class="sd">    :param dy: [description]</span>
<span class="sd">    :type dy: [type]</span>
<span class="sd">    :param archivo_salida: [description]</span>
<span class="sd">    :type archivo_salida: [type]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="c1"># define parameters for plotting</span>
    <span class="n">latmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Y_grid</span><span class="o">.</span><span class="n">flat</span><span class="p">)</span>
    <span class="n">latmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Y_grid</span><span class="o">.</span><span class="n">flat</span><span class="p">)</span>
    <span class="n">lonmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">X_grid</span><span class="o">.</span><span class="n">flat</span><span class="p">)</span>
    <span class="n">lonmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">X_grid</span><span class="o">.</span><span class="n">flat</span><span class="p">)</span>
    <span class="n">reg2</span><span class="o">=</span><span class="p">(</span><span class="n">lonmin</span><span class="p">,</span><span class="n">lonmax</span><span class="p">,</span><span class="n">latmin</span><span class="p">,</span><span class="n">latmax</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">fig</span><span class="o">=</span><span class="n">pygmt</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">spacing</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dx</span><span class="si">}</span><span class="s2">k/</span><span class="si">{</span><span class="n">dy</span><span class="si">}</span><span class="s2">k&quot;</span>
    <span class="n">cmap2use</span> <span class="o">=</span> <span class="s1">&#39;rainbow&#39;</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">pygmt</span><span class="o">.</span><span class="n">makecpt</span><span class="p">(</span><span class="n">cmap</span> <span class="o">=</span> 
              <span class="n">cmap2use</span><span class="p">,</span> 
              <span class="n">series</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Slip</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Slip</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> 
              <span class="n">background</span><span class="o">=</span><span class="s1">&#39;i&#39;</span><span class="p">,</span>
              <span class="n">continuous</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">grid</span><span class="o">=</span><span class="n">pygmt</span><span class="o">.</span><span class="n">xyz2grd</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">y</span><span class="o">=</span><span class="n">Y_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">z</span><span class="o">=</span><span class="n">Slip</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">region</span> <span class="o">=</span> <span class="n">reg2</span><span class="p">,</span><span class="n">spacing</span><span class="o">=</span><span class="n">spacing</span><span class="p">)</span>
    <span class="n">grid</span><span class="o">=</span><span class="n">pygmt</span><span class="o">.</span><span class="n">grdsample</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span><span class="n">spacing</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span><span class="n">region</span><span class="o">=</span><span class="n">reg2</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="s1">&#39;q&#39;</span><span class="p">)</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">pygmt</span><span class="o">.</span><span class="n">grd2cpt</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="n">grid</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span><span class="n">nlevels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">continuous</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">basemap</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;Q12c&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s1">&#39;ag&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">coast</span><span class="p">(</span><span class="n">land</span><span class="o">=</span><span class="s2">&quot;darkgray&quot;</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;Q12c&#39;</span><span class="p">,</span><span class="n">frame</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">water</span><span class="o">=</span><span class="s2">&quot;lightblue&quot;</span><span class="p">,</span><span class="n">borders</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;1/0.5p,black&quot;</span><span class="p">,</span> <span class="s2">&quot;2/0.5p,gray&quot;</span><span class="p">,</span> <span class="s2">&quot;3/0.5p,blue&quot;</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">grdimage</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> 
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
            <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;Q12c&#39;</span><span class="p">,</span>
            <span class="n">nan_transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;l+a+t1.0&#39;</span>
            <span class="p">)</span>
    <span class="c1"># fig.grdcontour(grid=grid,projection=&#39;Q12c&#39;)</span>
    <span class="c1"># fig.grdcontour(grid=grid,interval=3,annotation=0)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">lonfosa</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">latfosa</span><span class="p">,</span>
        <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;Q12c&#39;</span><span class="p">,</span>
        <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span>
        <span class="n">pen</span><span class="o">=</span><span class="s2">&quot;1p&quot;</span><span class="p">,</span>
        <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
        <span class="n">style</span><span class="o">=</span><span class="s2">&quot;f0.5i/0.1i+r+t+o1&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">frame</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a+3&#39;</span><span class="p">,</span><span class="s2">&quot;x+lSlip[m]&quot;</span><span class="p">],</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;Q12c&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">fig</span><span class="o">.</span><span class="n">inset</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="s2">&quot;jTL+w3.5c+o0.2c&quot;</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">box</span><span class="o">=</span><span class="s2">&quot;+p1.5p,gold&quot;</span><span class="p">):</span>
        <span class="c1"># Create a figure in the inset using coast. This example uses the azimuthal</span>
        <span class="c1"># orthogonal projection centered at 47E, 20S. The land color is set to</span>
        <span class="c1"># &quot;gray&quot; and Madagascar is highlighted in &quot;red3&quot;.</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">coast</span><span class="p">(</span>
            <span class="n">region</span><span class="o">=</span><span class="s2">&quot;g&quot;</span><span class="p">,</span>
            <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;G-70/-33/?&quot;</span><span class="p">,</span>
            <span class="n">land</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
            <span class="n">water</span><span class="o">=</span><span class="s2">&quot;royalblue&quot;</span><span class="p">,</span>
            <span class="n">dcw</span><span class="o">=</span><span class="s2">&quot;CL+gred3&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">shift_origin</span><span class="p">(</span><span class="n">yshift</span><span class="o">=</span><span class="s2">&quot;0c&quot;</span><span class="p">,</span><span class="n">xshift</span><span class="o">=</span><span class="s2">&quot;13c&quot;</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">data_lat</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">Y_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">data_lat</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">Y_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">())[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">data_lat</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Slip</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;X2c/12c&quot;</span><span class="p">,</span>
        <span class="c1"># Note that the y-axis annotation &quot;Counts&quot; is shown in x-axis direction</span>
        <span class="c1"># due to the rotation caused by horizontal=True</span>
        <span class="n">frame</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ag&quot;</span><span class="p">,</span> <span class="s2">&quot;WSne&quot;</span><span class="p">,</span><span class="s2">&quot;xaf+lSlip mean[m]&quot;</span><span class="p">],</span>
        <span class="n">region</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Slip</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">region</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">region</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
        <span class="n">x</span><span class="o">=</span><span class="n">data_lat</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">y</span><span class="o">=</span><span class="n">data_lat</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">pen</span><span class="o">=</span><span class="s2">&quot;2p,black&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">shift_origin</span><span class="p">(</span><span class="n">yshift</span><span class="o">=</span><span class="s1">&#39;13c&#39;</span><span class="p">,</span><span class="n">xshift</span><span class="o">=</span><span class="s1">&#39;-13c&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;X12c/3c&quot;</span><span class="p">,</span>
    <span class="c1"># Note that the y-axis annotation &quot;Counts&quot; is shown in x-axis direction</span>
    <span class="c1"># due to the rotation caused by horizontal=True</span>
    <span class="n">frame</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ag&quot;</span><span class="p">,</span> <span class="s2">&quot;WSne&quot;</span><span class="p">,</span><span class="s2">&quot;yaf+lSlip mean[m]&quot;</span><span class="p">],</span>
    <span class="n">region</span><span class="o">=</span><span class="p">[</span><span class="n">region</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">region</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Slip</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">X_grid</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Slip</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">pen</span><span class="o">=</span><span class="s2">&quot;2p,black&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">X_grid</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Slip</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Shift the plot origin and add right margin histogram</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span></div>


<div class="viewcode-block" id="plot_slip_gmt_relief">
<a class="viewcode-back" href="../main.html#geostochpy.plot_slip_gmt_relief">[docs]</a>
<span class="k">def</span> <span class="nf">plot_slip_gmt_relief</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="n">X_grid</span><span class="p">,</span><span class="n">Y_grid</span><span class="p">,</span><span class="n">lonfosa</span><span class="p">,</span><span class="n">latfosa</span><span class="p">,</span><span class="n">Slip</span><span class="p">,</span><span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a Slip grid of data on a grid</span>

<span class="sd">    :param region: [description]</span>
<span class="sd">    :type region: [type]</span>
<span class="sd">    :param X_grid: [description]</span>
<span class="sd">    :type X_grid: [type]</span>
<span class="sd">    :param Y_grid: [description]</span>
<span class="sd">    :type Y_grid: [type]</span>
<span class="sd">    :param lonfosa: [description]</span>
<span class="sd">    :type lonfosa: [type]</span>
<span class="sd">    :param latfosa: [description]</span>
<span class="sd">    :type latfosa: [type]</span>
<span class="sd">    :param Slip: [description]</span>
<span class="sd">    :type Slip: [type]</span>
<span class="sd">    :param dx: [description]</span>
<span class="sd">    :type dx: [type]</span>
<span class="sd">    :param dy: [description]</span>
<span class="sd">    :type dy: [type]</span>
<span class="sd">    :param archivo_salida: [description]</span>
<span class="sd">    :type archivo_salida: [type]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="c1"># define parameters for plotting</span>
    <span class="n">latmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Y_grid</span><span class="o">.</span><span class="n">flat</span><span class="p">)</span>
    <span class="n">latmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Y_grid</span><span class="o">.</span><span class="n">flat</span><span class="p">)</span>
    <span class="n">lonmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">X_grid</span><span class="o">.</span><span class="n">flat</span><span class="p">)</span>
    <span class="n">lonmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">X_grid</span><span class="o">.</span><span class="n">flat</span><span class="p">)</span>
    <span class="n">reg2</span><span class="o">=</span><span class="p">(</span><span class="n">lonmin</span><span class="p">,</span><span class="n">lonmax</span><span class="p">,</span><span class="n">latmin</span><span class="p">,</span><span class="n">latmax</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">fig</span><span class="o">=</span><span class="n">pygmt</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">spacing</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dx</span><span class="si">}</span><span class="s2">k/</span><span class="si">{</span><span class="n">dy</span><span class="si">}</span><span class="s2">k&quot;</span>
    <span class="n">cmap2use</span> <span class="o">=</span> <span class="s1">&#39;rainbow&#39;</span>
    <span class="n">relief</span><span class="o">=</span><span class="n">pygmt</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">load_earth_relief</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;05m&#39;</span><span class="p">)</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">pygmt</span><span class="o">.</span><span class="n">makecpt</span><span class="p">(</span><span class="n">cmap</span> <span class="o">=</span> 
              <span class="n">cmap2use</span><span class="p">,</span> 
              <span class="n">series</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Slip</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Slip</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> 
              <span class="n">background</span><span class="o">=</span><span class="s1">&#39;i&#39;</span><span class="p">,</span>
              <span class="n">continuous</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">grid</span><span class="o">=</span><span class="n">pygmt</span><span class="o">.</span><span class="n">xyz2grd</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">y</span><span class="o">=</span><span class="n">Y_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">z</span><span class="o">=</span><span class="n">Slip</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">region</span> <span class="o">=</span> <span class="n">reg2</span><span class="p">,</span><span class="n">spacing</span><span class="o">=</span><span class="n">spacing</span><span class="p">)</span>
    <span class="c1"># grid=pygmt.grdsample(grid,spacing=spacing2,region=reg2,verbose=&#39;q&#39;)</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">pygmt</span><span class="o">.</span><span class="n">grd2cpt</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="n">grid</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span><span class="n">nlevels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">continuous</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">basemap</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;Q12c&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s1">&#39;ag&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">coast</span><span class="p">(</span><span class="n">land</span><span class="o">=</span><span class="s2">&quot;darkgray&quot;</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;Q12c&#39;</span><span class="p">,</span><span class="n">frame</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">water</span><span class="o">=</span><span class="s2">&quot;lightblue&quot;</span><span class="p">,</span><span class="n">borders</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;1/0.5p,black&quot;</span><span class="p">,</span> <span class="s2">&quot;2/0.5p,gray&quot;</span><span class="p">,</span> <span class="s2">&quot;3/0.5p,blue&quot;</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">grdimage</span><span class="p">(</span><span class="n">relief</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;Q12c&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">grdimage</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> 
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
            <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;Q12c&#39;</span><span class="p">,</span>
            <span class="n">nan_transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;l+a+t1.0&#39;</span>
            <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">grdcontour</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="n">grid</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;Q12c&#39;</span><span class="p">)</span>
    <span class="c1"># fig.grdcontour(grid=grid,interval=3,annotation=0)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">lonfosa</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">latfosa</span><span class="p">,</span>
        <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;Q12c&#39;</span><span class="p">,</span>
        <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span>
        <span class="n">pen</span><span class="o">=</span><span class="s2">&quot;1p&quot;</span><span class="p">,</span>
        <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
        <span class="n">style</span><span class="o">=</span><span class="s2">&quot;f0.5i/0.1i+r+t+o1&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">frame</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a+3&#39;</span><span class="p">,</span><span class="s2">&quot;x+lSlip[m]&quot;</span><span class="p">],</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;Q12c&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">fig</span><span class="o">.</span><span class="n">inset</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="s2">&quot;jTL+w3.5c+o0.2c&quot;</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">box</span><span class="o">=</span><span class="s2">&quot;+p1.5p,gold&quot;</span><span class="p">):</span>
        <span class="c1"># Create a figure in the inset using coast. This example uses the azimuthal</span>
        <span class="c1"># orthogonal projection centered at 47E, 20S. The land color is set to</span>
        <span class="c1"># &quot;gray&quot; and Madagascar is highlighted in &quot;red3&quot;.</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">coast</span><span class="p">(</span>
            <span class="n">region</span><span class="o">=</span><span class="s2">&quot;g&quot;</span><span class="p">,</span>
            <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;G-70/-33/?&quot;</span><span class="p">,</span>
            <span class="n">land</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
            <span class="n">water</span><span class="o">=</span><span class="s2">&quot;royalblue&quot;</span><span class="p">,</span>
            <span class="n">dcw</span><span class="o">=</span><span class="s2">&quot;CL+gred3&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">shift_origin</span><span class="p">(</span><span class="n">yshift</span><span class="o">=</span><span class="s2">&quot;0c&quot;</span><span class="p">,</span><span class="n">xshift</span><span class="o">=</span><span class="s2">&quot;13c&quot;</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">data_lat</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">Y_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">data_lat</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">Y_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">())[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">data_lat</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Slip</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;X2c/12c&quot;</span><span class="p">,</span>
        <span class="c1"># Note that the y-axis annotation &quot;Counts&quot; is shown in x-axis direction</span>
        <span class="c1"># due to the rotation caused by horizontal=True</span>
        <span class="n">frame</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ag&quot;</span><span class="p">,</span> <span class="s2">&quot;WSne&quot;</span><span class="p">,</span><span class="s2">&quot;xaf+lSlip mean[m]&quot;</span><span class="p">],</span>
        <span class="n">region</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Slip</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">region</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">region</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
        <span class="n">x</span><span class="o">=</span><span class="n">data_lat</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">y</span><span class="o">=</span><span class="n">data_lat</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">pen</span><span class="o">=</span><span class="s2">&quot;2p,black&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">shift_origin</span><span class="p">(</span><span class="n">yshift</span><span class="o">=</span><span class="s1">&#39;13c&#39;</span><span class="p">,</span><span class="n">xshift</span><span class="o">=</span><span class="s1">&#39;-13c&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;X12c/3c&quot;</span><span class="p">,</span>
    <span class="c1"># Note that the y-axis annotation &quot;Counts&quot; is shown in x-axis direction</span>
    <span class="c1"># due to the rotation caused by horizontal=True</span>
    <span class="n">frame</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ag&quot;</span><span class="p">,</span> <span class="s2">&quot;WSne&quot;</span><span class="p">,</span><span class="s2">&quot;yaf+lSlip mean[m]&quot;</span><span class="p">],</span>
    <span class="n">region</span><span class="o">=</span><span class="p">[</span><span class="n">region</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">region</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Slip</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">X_grid</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Slip</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">pen</span><span class="o">=</span><span class="s2">&quot;2p,black&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">X_grid</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Slip</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Shift the plot origin and add right margin histogram</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="plot_slip_css">
<a class="viewcode-back" href="../main.html#geostochpy.plot_slip_css">[docs]</a>
<span class="k">def</span> <span class="nf">plot_slip_css</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">lonfosa</span><span class="p">,</span> <span class="n">latfosa</span><span class="p">,</span> <span class="n">Slip</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots the CSS projection of a SlipLine</span>

<span class="sd">    :param region: [description]</span>
<span class="sd">    :type region: [type]</span>
<span class="sd">    :param lons: [description]</span>
<span class="sd">    :type lons: [type]</span>
<span class="sd">    :param lats: [description]</span>
<span class="sd">    :type lats: [type]</span>
<span class="sd">    :param lonfosa: [description]</span>
<span class="sd">    :type lonfosa: [type]</span>
<span class="sd">    :param latfosa: [description]</span>
<span class="sd">    :type latfosa: [type]</span>
<span class="sd">    :param Slip: [description]</span>
<span class="sd">    :type Slip: [type]</span>
<span class="sd">    :param cmap: [description], defaults to &#39;rainbow&#39;</span>
<span class="sd">    :type cmap: str, optional</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Mercator</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dms</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">x_inline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">y_inline</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># Transformar coordenadas geogrÃ¡ficas a coordenadas del mapa</span>
    <span class="c1"># mlons, mlats = ax.projection.transform_points(ccrs.Mercator(), lons, lats)</span>
    <span class="c1"># mfosalons, mfosalats = ax.projection.transform_point(ccrs.Mercator(),lonfosa, latfosa)</span>
    <span class="c1"># Crear la visualizaciÃ³n de los datos de Slip</span>
    <span class="n">my_cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">csave</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">lons</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span> <span class="n">Slip</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">my_cmap</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;gouraud&#39;</span><span class="p">)</span>

    <span class="c1"># AÃ±adir barra de color</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">csave</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>

    <span class="c1"># AÃ±adir lÃ­mites de la fosa</span>
    <span class="c1"># ax.plot(mfosalons, mfosalats, marker=None, color=&#39;k&#39;)</span>

    <span class="c1"># AÃ±adir caracterÃ­sticas geogrÃ¡ficas</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">COASTLINE</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">LAND</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">RIVERS</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">BORDERS</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="plot_grid">
<a class="viewcode-back" href="../main.html#geostochpy.plot_grid">[docs]</a>
<span class="k">def</span> <span class="nf">plot_grid</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the grid of earthquake data .</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">pygmt</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="c1"># Chilean trench</span>
    <span class="n">data_trench</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s2">&quot;trench-chile.txt&quot;</span><span class="p">)</span>
    <span class="c1"># Load sample grid (3 arc-minutes global relief) in target area</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">pygmt</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">load_earth_relief</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="s2">&quot;30s&quot;</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">)</span>
    <span class="n">data_grid</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;./Output_data/&#39;</span><span class="o">+</span><span class="n">timestr</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">corner</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">corner</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;.xyz&#39;</span><span class="p">)</span>
    <span class="c1"># Plot original grid</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">basemap</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;M0/0/12c&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">grdimage</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="n">grid</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;oleron&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data_trench</span><span class="p">,</span>
        <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span>
        <span class="n">pen</span><span class="o">=</span><span class="s2">&quot;0.2p&quot;</span><span class="p">,</span>
        <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
        <span class="n">style</span><span class="o">=</span><span class="s2">&quot;f0.5i/0.1i+r+t+o1&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_grid</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;p0.2c&quot;</span><span class="p">,</span> <span class="n">pen</span><span class="o">=</span><span class="s2">&quot;2p,red&quot;</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./Output_images/&#39;</span><span class="o">+</span><span class="n">timestr</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">corner</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">corner</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="plot_3d">
<a class="viewcode-back" href="../main.html#geostochpy.plot_3d">[docs]</a>
<span class="k">def</span> <span class="nf">plot_3d</span><span class="p">(</span><span class="n">X_array</span><span class="p">,</span><span class="n">Y_array</span><span class="p">,</span><span class="n">depth</span><span class="p">,</span><span class="n">Slip</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a 3D plot of a 3D Slip grid with a depth of the surface .</span>

<span class="sd">    :param X_array: [description]</span>
<span class="sd">    :type X_array: [type]</span>
<span class="sd">    :param Y_array: [description]</span>
<span class="sd">    :type Y_array: [type]</span>
<span class="sd">    :param depth: [description]</span>
<span class="sd">    :type depth: [type]</span>
<span class="sd">    :param Slip: [description]</span>
<span class="sd">    :type Slip: [type]</span>
<span class="sd">    :param filename: [description], defaults to None</span>
<span class="sd">    :type filename: [type], optional</span>
<span class="sd">    :return: [description]</span>
<span class="sd">    :rtype: [type]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
    <span class="c1"># Plot the surface with face colors taken from the array we made.</span>
    <span class="n">surf</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X_array</span><span class="p">,</span><span class="n">Y_array</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">(</span><span class="n">Slip</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Slip</span><span class="o">.</span><span class="n">flatten</span><span class="p">())),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Customize the z axis.</span>
    <span class="c1"># Agregar barra de colores con el rango correcto</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Slip</span><span class="o">.</span><span class="n">flat</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Slip</span><span class="o">.</span><span class="n">flat</span><span class="p">))</span>
    <span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
    <span class="n">sm</span><span class="o">.</span><span class="n">set_array</span><span class="p">([])</span>  <span class="c1"># este paso es necesario para que la barra de colores refleje correctamente los valores</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Slip_0004_Simulation&#39;</span><span class="p">)</span>
    <span class="c1"># Configurar etiquetas</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Depth&#39;</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Slip[m]&#39;</span><span class="p">)</span>
    <span class="c1"># Configurar posiciÃ³n de la barra de colores</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>  <span class="c1"># Puedes ajustar la posiciÃ³n segÃºn tus necesidades</span>
    <span class="k">if</span> <span class="n">filename</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="plot_deformation_gmt">
<a class="viewcode-back" href="../main.html#geostochpy.plot_deformation_gmt">[docs]</a>
<span class="k">def</span> <span class="nf">plot_deformation_gmt</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="n">X_grid</span><span class="p">,</span><span class="n">Y_grid</span><span class="p">,</span><span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="p">,</span><span class="n">lonfosa</span><span class="p">,</span><span class="n">latfosa</span><span class="p">,</span><span class="n">Deformation</span><span class="p">,</span><span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a Slip grid of data on a grid</span>

<span class="sd">    :param region: [description]</span>
<span class="sd">    :type region: [type]</span>
<span class="sd">    :param X_grid: [description]</span>
<span class="sd">    :type X_grid: [type]</span>
<span class="sd">    :param Y_grid: [description]</span>
<span class="sd">    :type Y_grid: [type]</span>
<span class="sd">    :param lonfosa: [description]</span>
<span class="sd">    :type lonfosa: [type]</span>
<span class="sd">    :param latfosa: [description]</span>
<span class="sd">    :type latfosa: [type]</span>
<span class="sd">    :param Slip: [description]</span>
<span class="sd">    :type Slip: [type]</span>
<span class="sd">    :param dx: [description]</span>
<span class="sd">    :type dx: [type]</span>
<span class="sd">    :param dy: [description]</span>
<span class="sd">    :type dy: [type]</span>
<span class="sd">    :param archivo_salida: [description]</span>
<span class="sd">    :type archivo_salida: [type]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="c1"># define parameters for plotting</span>
    <span class="n">latmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Y_grid</span><span class="o">.</span><span class="n">flat</span><span class="p">)</span>
    <span class="n">latmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Y_grid</span><span class="o">.</span><span class="n">flat</span><span class="p">)</span>
    <span class="n">lonmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">X_grid</span><span class="o">.</span><span class="n">flat</span><span class="p">)</span>
    <span class="n">lonmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">X_grid</span><span class="o">.</span><span class="n">flat</span><span class="p">)</span>
    <span class="n">reg2</span><span class="o">=</span><span class="p">(</span><span class="n">lonmin</span><span class="p">,</span><span class="n">lonmax</span><span class="p">,</span><span class="n">latmin</span><span class="p">,</span><span class="n">latmax</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">fig</span><span class="o">=</span><span class="n">pygmt</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">spacing</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dx</span><span class="si">}</span><span class="s2">k/</span><span class="si">{</span><span class="n">dy</span><span class="si">}</span><span class="s2">k&quot;</span>
    <span class="n">cmap2use</span> <span class="o">=</span> <span class="s1">&#39;polar&#39;</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">pygmt</span><span class="o">.</span><span class="n">makecpt</span><span class="p">(</span><span class="n">cmap</span> <span class="o">=</span> 
              <span class="n">cmap2use</span><span class="p">,</span> 
              <span class="n">series</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Deformation</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Deformation</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span><span class="mi">2</span><span class="p">],</span> 
              <span class="n">background</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">continuous</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">grid</span><span class="o">=</span><span class="n">pygmt</span><span class="o">.</span><span class="n">xyz2grd</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">y</span><span class="o">=</span><span class="n">Y_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">z</span><span class="o">=</span><span class="n">Deformation</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">region</span> <span class="o">=</span> <span class="n">reg2</span><span class="p">,</span><span class="n">spacing</span><span class="o">=</span><span class="n">spacing</span><span class="p">)</span>
    <span class="n">grid</span><span class="o">=</span><span class="n">pygmt</span><span class="o">.</span><span class="n">grdsample</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span><span class="n">spacing</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span><span class="n">region</span><span class="o">=</span><span class="n">reg2</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="s1">&#39;q&#39;</span><span class="p">)</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">pygmt</span><span class="o">.</span><span class="n">grd2cpt</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="n">grid</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;polar&#39;</span><span class="p">,</span><span class="n">nlevels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">continuous</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">basemap</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;Q12c&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s1">&#39;ag&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">coast</span><span class="p">(</span><span class="n">land</span><span class="o">=</span><span class="s2">&quot;darkgray&quot;</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;Q12c&#39;</span><span class="p">,</span><span class="n">frame</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">water</span><span class="o">=</span><span class="s2">&quot;lightblue&quot;</span><span class="p">,</span><span class="n">borders</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;1/0.5p,black&quot;</span><span class="p">,</span> <span class="s2">&quot;2/0.5p,gray&quot;</span><span class="p">,</span> <span class="s2">&quot;3/0.5p,blue&quot;</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">grdimage</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> 
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
            <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;Q12c&#39;</span><span class="p">,</span>
            <span class="n">nan_transparent</span><span class="o">=</span><span class="s1">&#39;+z0&#39;</span><span class="p">,</span>
            <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;l+a+t1.0&#39;</span>
            <span class="p">)</span>
    <span class="c1"># fig.grdcontour(grid=grid,projection=&#39;Q12c&#39;)</span>
    <span class="c1"># fig.grdcontour(grid=grid,interval=3,annotation=0)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">lonfosa</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">latfosa</span><span class="p">,</span>
        <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;Q12c&#39;</span><span class="p">,</span>
        <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span>
        <span class="n">pen</span><span class="o">=</span><span class="s2">&quot;1p&quot;</span><span class="p">,</span>
        <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
        <span class="n">style</span><span class="o">=</span><span class="s2">&quot;f0.5i/0.1i+r+t+o1&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">frame</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a+3&#39;</span><span class="p">,</span><span class="s2">&quot;x+lVertical Displacement[m]&quot;</span><span class="p">],</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;Q12c&#39;</span><span class="p">)</span>
    <span class="c1">#cities</span>
    <span class="c1">#valparaiso</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=-</span><span class="mf">71.3</span><span class="p">,</span><span class="n">y</span><span class="o">=</span> <span class="o">-</span><span class="mf">33.03</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;ValparaÃ­so&#39;</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="n">justify</span><span class="o">=</span><span class="s1">&#39;ML&#39;</span><span class="p">,</span><span class="n">pen</span><span class="o">=</span><span class="s2">&quot;1p,black&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=-</span><span class="mf">71.63</span><span class="p">,</span><span class="n">y</span><span class="o">=-</span><span class="mf">33.03</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;c0.2c&#39;</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="n">pen</span><span class="o">=</span><span class="s2">&quot;1p,black&quot;</span><span class="p">)</span>
    <span class="c1"># la serena</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=-</span><span class="mf">71.2</span><span class="p">,</span><span class="n">y</span><span class="o">=</span> <span class="o">-</span><span class="mf">30.03</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;La Serena&#39;</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="n">justify</span><span class="o">=</span><span class="s1">&#39;ML&#39;</span><span class="p">,</span><span class="n">pen</span><span class="o">=</span><span class="s2">&quot;1p,black&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=-</span><span class="mf">71.4</span><span class="p">,</span><span class="n">y</span><span class="o">=-</span><span class="mf">30.03</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;c0.2c&#39;</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="n">pen</span><span class="o">=</span><span class="s2">&quot;1p,black&quot;</span><span class="p">)</span>
    <span class="c1">#santiago</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=-</span><span class="mf">70.4</span><span class="p">,</span><span class="n">y</span><span class="o">=</span> <span class="o">-</span><span class="mf">33.45</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;Santiago&#39;</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="n">justify</span><span class="o">=</span><span class="s1">&#39;ML&#39;</span><span class="p">,</span><span class="n">pen</span><span class="o">=</span><span class="s2">&quot;1p,black&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=-</span><span class="mf">70.6</span><span class="p">,</span><span class="n">y</span><span class="o">=-</span><span class="mf">33.45</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;c0.2c&#39;</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="n">pen</span><span class="o">=</span><span class="s2">&quot;1p,black&quot;</span><span class="p">)</span>
    <span class="c1"># talca</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=-</span><span class="mf">71.6</span><span class="p">,</span><span class="n">y</span><span class="o">=</span> <span class="o">-</span><span class="mf">35.43</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;Talca&#39;</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="n">justify</span><span class="o">=</span><span class="s1">&#39;ML&#39;</span><span class="p">,</span><span class="n">pen</span><span class="o">=</span><span class="s2">&quot;1p,black&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=-</span><span class="mf">71.8</span><span class="p">,</span><span class="n">y</span><span class="o">=-</span><span class="mf">35.43</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;c0.2c&#39;</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="n">pen</span><span class="o">=</span><span class="s2">&quot;1p,black&quot;</span><span class="p">)</span>
    <span class="c1"># concepcion</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=-</span><span class="mf">72.8</span><span class="p">,</span><span class="n">y</span><span class="o">=</span> <span class="o">-</span><span class="mf">36.812</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;ConcepciÃ³n&#39;</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="n">justify</span><span class="o">=</span><span class="s1">&#39;ML&#39;</span><span class="p">,</span><span class="n">pen</span><span class="o">=</span><span class="s2">&quot;1p,black&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=-</span><span class="mf">73.039</span><span class="p">,</span><span class="n">y</span><span class="o">=-</span><span class="mf">36.812</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;c0.2c&#39;</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="n">pen</span><span class="o">=</span><span class="s2">&quot;1p,black&quot;</span><span class="p">)</span>
        <span class="c1"># Shift the plot origin and add right margin histogram</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="plot_deformation">
<a class="viewcode-back" href="../main.html#geostochpy.plot_deformation">[docs]</a>
<span class="k">def</span> <span class="nf">plot_deformation</span><span class="p">(</span><span class="n">X_grid</span><span class="p">,</span><span class="n">Y_grid</span><span class="p">,</span><span class="n">lonfosa</span><span class="p">,</span><span class="n">latfosa</span><span class="p">,</span><span class="n">Deformation</span><span class="p">,</span><span class="n">filename</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">colors</span>
    <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="c1"># iniciliazar mapa</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;merc&#39;</span><span class="p">,</span> <span class="n">lat_0</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span> <span class="n">lon_0</span><span class="o">=</span><span class="mi">210</span><span class="p">,</span>
        <span class="n">resolution</span> <span class="o">=</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span>
        <span class="n">llcrnrlon</span><span class="o">=-</span><span class="mi">78</span><span class="p">,</span> <span class="n">llcrnrlat</span><span class="o">=-</span><span class="mi">38</span><span class="p">,</span>
        <span class="n">urcrnrlon</span><span class="o">=-</span><span class="mi">68</span><span class="p">,</span> <span class="n">urcrnrlat</span><span class="o">=-</span><span class="mi">28</span><span class="p">)</span>
    <span class="c1"># transformar coordenadas geograficas a coord de mapa</span>
    <span class="n">mlons</span><span class="p">,</span> <span class="n">mlats</span>         <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">X_grid</span><span class="p">,</span><span class="n">Y_grid</span><span class="p">)</span>
    <span class="n">mfosalons</span><span class="p">,</span> <span class="n">mfosalats</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">lonfosa</span><span class="p">,</span> <span class="n">latfosa</span><span class="p">)</span>
    <span class="c1"># anexos</span>
    <span class="n">m</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mfosalons</span><span class="p">,</span> <span class="n">mfosalats</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">drawcoastlines</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">drawcountries</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">fillcontinents</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">lake_color</span><span class="o">=</span><span class="s1">&#39;aqua&#39;</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">drawmapboundary</span><span class="p">(</span><span class="n">fill_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
    <span class="c1"># m.drawmeridians(np.arange(-180,180,2),labels=[1,1,0,1])</span>
    <span class="c1"># m.drawparallels(np.arange(-50,-30,2),labels=[1,1,0,1])</span>
    <span class="n">m</span><span class="o">.</span><span class="n">drawparallels</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="o">-</span><span class="mi">25</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">m</span><span class="o">.</span><span class="n">drawmeridians</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">68</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="c1"># promedio</span>
    <span class="n">csave</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">mlons</span><span class="p">,</span> <span class="n">mlats</span><span class="p">,</span> <span class="n">Deformation</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">colors</span><span class="o">.</span><span class="n">CenteredNorm</span><span class="p">(),</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span><span class="n">shading</span><span class="o">=</span><span class="s1">&#39;gouraud&#39;</span><span class="p">)</span>
    <span class="n">cbar</span>     <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">csave</span><span class="p">,</span><span class="n">location</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Seafloor deformation (dZ) [m]&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">1200</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<span class="c1">#### FUNCTION FOR DATABASE</span>
<div class="viewcode-block" id="get_data">
<a class="viewcode-back" href="../main.html#geostochpy.get_data">[docs]</a>
<span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_ROOT</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Alex Villarroel.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>